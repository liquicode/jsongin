!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.jsongin=r():e.jsongin=r()}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var e={2863:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"o",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o);if("a"!==a&&(o=[o]),"a"!==a)return e.OpLog&&e.OpLog(`$all: document requires an array but found type [${a}] instead at [${n}].`),!1;let u=e.ShortType(t);if("a"!==u)return e.OpLog&&e.OpLog(`$all: match requires an array but found type [${u}] instead at [${n}].`),!1;for(let a=0;a<t.length;a++){let i=!1,p=e.ShortType(t[a]);if("bnsl".includes(p)?i=o.includes(t[a]):"o"===p?i=e.Query(r,t[a],n):e.OpLog&&e.OpLog(`$all: sub-match requires "bnslo" but found type [${u}] instead at [${n}].`),!1===i)return!1}return!0}catch(r){throw e.OpError&&e.OpError(`Query.$all: ${r.message}`),r}}}}},3999:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"o",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o);if("a"!==a)return e.OpLog&&e.OpLog(`$elemMatch: document requires an array but found type [${a}] instead at [${n}].`),!1;let u=e.ShortType(t);if("o"!==u)return e.OpLog&&e.OpLog(`$elemMatch: match requires an object but found type [${u}] instead at [${n}].`),!1;for(let a=0;a<o.length;a++){let o=e.JoinPaths(n,a);if(!0===e.Query(r,t,o))return!0}return!1}catch(r){throw e.OpError&&e.OpError(`Query.$elemMatch: ${r.message}`),r}}}}},4950:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"n",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o);if("a"!==a)return e.OpLog&&e.OpLog(`$size: requires an array but found type [${a}] instead at [${n}].`),!1;let u=e.ShortType(t);return"n"!==u?(e.OpLog&&e.OpLog(`$size: requires a number but found type [${u}] instead at [${n}].`),!1):o.length===t}catch(r){throw e.OpError&&e.OpError(`Query.$size: ${r.message}`),r}}}}},3374:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),u=t,i=e.ShortType(u);if("bnslru".includes(i)&&i===a)return o===u;if("lu".includes(i)&&"lu".includes(a))return!0;if("o"===i&&"o"===a)return!0==(JSON.stringify(u)===JSON.stringify(o));if("a"===i&&"a"===a){let e=JSON.stringify(u),r=e===JSON.stringify(o);if(!0===r)return!0;for(let t=0;t<o.length&&(r=e===JSON.stringify(o[t]),!0!==r);t++);return!0===r}return e.OpLog&&e.OpLog(`$eq: cannot compare [${i}] type with [${a}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$eq: ${r.message}`),r}}}}},5132:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bns",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),u=t,i=e.ShortType(u);if("bns".includes(i)&&i===a)return o>u;if("a".includes(a)){let e=!1;for(let r=0;r<o.length;r++)if(e=o[r]>u,!0===e)return!0;return!1}return e.OpLog&&e.OpLog(`$gt: cannot compare [${i}] type with [${a}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$gt: ${r.message}`),r}}}}},7588:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnslu",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),u=t,i=e.ShortType(u);if("bns".includes(i)&&i===a)return o>=u;if("lu".includes(i)&&"lu".includes(a))return!0;if("a".includes(a)){let e=!1;for(let r=0;r<o.length;r++)if(e=o[r]>=u,!0===e)return!0;return!1}return e.OpLog&&e.OpLog(`$gte: cannot compare [${i}] type with [${a}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$gte: ${r.message}`),r}}}}},4038:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"a",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),u=t,i=e.ShortType(u);if("a"!==i)return e.OpLog&&e.OpLog(`$in: expected an array but found a type [${i}] instead at [${n}].`),!1;function p(e,r,t){if("r"===e.ShortType(t)){for(let e=0;e<r.length;e++)if(t.test(r[e]))return!0}else if(r.includes(t))return!0;return!1}if("a"===a){for(let l=0;l<u.length;l++)if(p(e,o,u[l]))return!0}else if("bnslou".includes(a)&&p(e,u,o))return!0;return e.OpLog&&e.OpLog(`$in: cannot compare [${i}] type with [${a}] type at [${n}].`),!1}catch(s){throw e.OpError&&e.OpError(`Query.$in: ${s.message}`),s}}}}},2207:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bns",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),u=t,i=e.ShortType(u);if("bns".includes(i)&&i===a)return o<u;if("a".includes(a)){let e=!1;for(let r=0;r<o.length;r++)if(e=o[r]<u,!0===e)return!0;return!1}return e.OpLog&&e.OpLog(`$lt: cannot compare [${i}] type with [${a}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$lt: ${r.message}`),r}}}}},424:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnslu",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),u=t,i=e.ShortType(u);if("bns".includes(i)&&i===a)return o<=u;if("lu".includes(i)&&"lu".includes(a))return!0;if("a".includes(a)){let e=!1;for(let r=0;r<o.length;r++)if(e=o[r]<=u,!0===e)return!0;return!1}return e.OpLog&&e.OpLog(`$lte: cannot compare [${i}] type with [${a}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$lte: ${r.message}`),r}}}}},3490:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloau",Query:function(r,t,n=""){return!e.QueryOperators.$eq.Query(r,t,n)}}}},7879:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"a",Query:function(r,t,n=""){return!e.QueryOperators.$in.Query(r,t,n)}}}},5611:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),u=e.ShortType(t);if("b"!==u)return e.OpLog&&e.OpLog(`$exists: requires a boolean but found type [${u}] instead at [${n}].`),!1;if(!0===t){if("u"!==a)return!0}else if("u"===a)return!0;return!1}catch(r){throw e.OpError&&e.OpError(`Query.$exists: ${r.message}`),r}}}}},6475:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"nsa",Query:function(r,t,n=""){try{let o=e.GetValue(r,n);"a"!==e.ShortType(o)&&(o=[o]);let a=e.ShortType(t);"a"!==a&&(t=[t]);for(let r=0;r<t.length;r++){let u=t[r];if(a=e.ShortType(u),"n"===a){for(let r=0;r<o.length;r++)if(u===e.BsonType(o[r],!1))return!0}else{if("s"!==a)return e.OpLog&&e.OpLog(`$type: requires a number or string but found type [${a}] instead at [${n}].`),!1;for(let r=0;r<o.length;r++){let t=e.BsonType(o[r],!0);if(u===t)return!0;if("number"===u&&["int","long","double","decimal"].includes(t))return!0}}}return!1}catch(r){throw e.OpError&&e.OpError(`Query.$type: ${r.message}`),r}}}}},6940:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"sr",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=(e.ShortType(o),t),u=e.ShortType(a);return"sr".includes(u)?("s"===u&&(a=new RegExp(a)),a.test(o)):(e.OpLog&&e.OpLog(`$regex: requires regexp or string but found [${u}] instead at [${n}].`),!1)}catch(r){throw e.OpError&&e.OpError(`Query.$regex: ${r.message}`),r}}}}},8469:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),u=t,i=e.ShortType(u),p=e.IsQuery(u),l=!1;if("bnslu".includes(a)&&"bnslu".includes(i))return l=e.QueryOperators.$eq.Query(r,u,n),l;if("bnslu".includes(a)&&"a".includes(i))return e.OpLog&&e.OpLog(`ImplicitEq: cannot compare [${i}] type with [${a}] type at [${n}].`),!1;if("bnslu".includes(a)&&"o".includes(i))return p?(l=e.Query(r,u,n),l):(e.OpLog&&e.OpLog(`ImplicitEq: requires query when comparing against [${a}] type with [${a}] type at [${n}].`),!1);if("a".includes(a)&&"bnslu".includes(i))return l=o.includes(u),l;if("a".includes(a)&&"o".includes(i)){for(let t=0;t<o.length;t++){let o=e.JoinPaths(n,t);if(l=p?e.Query(r,u,o):e.QueryOperators.$eq.Query(r,u,o),!0===l)return!0}return!1}if("a".includes(a)&&"a".includes(i))return l=e.QueryOperators.$eq.Query(r,u,n),l;if("a".includes(a)&&"r".includes(i)){for(let t=0;t<o.length;t++){let o=e.JoinPaths(n,t);if(l=e.QueryOperators.$regex.Query(r,u,o),!1===l)return!1}return!0}return"o".includes(a)&&"o".includes(i)?p?(l=e.Query(r,u,n),l):(l=e.QueryOperators.$eq.Query(r,u,n),l):"s".includes(a)&&"r".includes(i)?(l=e.QueryOperators.$regex.Query(r,u,n),l):(e.OpLog&&e.OpLog(`ImplicitEq: cannot compare [${i}] type with [${a}] type at [${n}].`),!1)}catch(r){throw e.OpError&&e.OpError(`Query.$ImplicitEq: ${r.message}`),r}}}}},2239:e=>{e.exports=e.exports=function(e){let r={Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(t,n,o=""){try{let a=e.GetValue(t,o),u=e.ShortType(a),i=n,p=e.ShortType(i);if("bns".includes(p)&&"bns".includes(u))return a==i;if("lu".includes(p)&&"lu".includes(u))return!0;if("bnslu".includes(p)||"bnslu".includes(u))return e.OpLog&&e.OpLog(`Query.$eqx: cannot compare primitive types to non-primitive types at [${o}].`),!1;if("o"===p&&"o"===u){for(let e in a)if(!1===r.Query(a[e],i[e],""))return!1;return!0}if("a"===p&&"a"===u){if(i.length!==a.length)return!1;let e=[...a];for(let t=0;t<i.length;t++){let n=!1;for(let o=0;o<e.length;o++)if(r.Query(i[t],e[o],"")){n=!0,e.splice(o,1);break}if(!1===n)return!1}return!0}return e.OpLog&&e.OpLog(`Query.$eqx: cannot compare [${p}] type with [${value_type}] type at [${o}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$eqx: ${r.message}`),r}}};return r}},4105:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloau",Query:function(r,t,n=""){return!e.QueryOperators.$eqx.Query(r,t,n)}}}},3565:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(r,t,n=""){return e.OpLog&&e.OpLog(`$noop: always returns true at [${n}].`),!0},ToMongoQuery:function(e){},ToSql:function(e){return""}}}},8250:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(e,r,t=""){return!0},ToMongoQuery:function(e){},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},3209:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(r,t,n){try{let o=e.ShortType(t);if("a"!==o)return e.OpLog&&e.OpLog(`$and: requires an array but found type [${o}] instead at [${n}].`),!1;for(let o=0;o<t.length;o++)if(!1===e.Query(r,t[o],n))return!1;return!0}catch(r){throw e.OpError&&e.OpError(`Query.$and: ${r.message}`),r}}}}},5809:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(r,t,n=""){try{let o=e.ShortType(t);if("a"!==o)return e.OpLog&&e.OpLog(`$nor: requires an array but found type [${o}] instead at [${n}].`),!1;for(let o=0;o<t.length;o++)if(!0===e.Query(r,t[o],n))return!1;return!0}catch(r){throw e.OpError&&e.OpError(`Query.$nor: ${r.message}`),r}}}}},1008:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"or",Query:function(r,t,n=""){try{let o=t,a=e.ShortType(o),u=!1;return"o"===a?u=e.Query(r,o,n):"r"===a?u=e.QueryOperators.$regex.Query(r,o,n):e.OpLog&&e.OpLog(`$not: requires an object or regexp but found type [${a}] instead at [${n}].`),!u}catch(r){throw e.OpError&&e.OpError(`Query.$not: ${r.message}`),r}}}}},7577:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(r,t,n=""){try{let o=e.ShortType(t);if("a"!==o)return e.OpLog&&e.OpLog(`$or: requires an array but found type [${o}] instead at [${n}].`),!1;for(let o=0;o<t.length;o++)if(!0===e.Query(r,t[o],n))return!0;return!1}catch(r){throw e.OpError&&e.OpError(`Query.$or: ${r.message}`),r}}}}},5778:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o);"a"===e.ShortType(a)?a.includes(t[o])||(a.push(t[o]),!1!==e.SetValue(r,o,a)||(e.OpLog&&Engine.OpLog(`Update.$addToSet: Setting the value of [${o}] to [${JSON.stringify(value)}] failed.`),n=!1)):(e.OpLog&&e.OpLog(`Update.$addToSet: The field [${o}] must be an array.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$addToSet: ${r.message}`),r}}}}},7585:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o);if("a"!==e.ShortType(a)){e.OpLog&&e.OpLog(`Update.$pop: The field [${o}] must be an array.`),n=!1;continue}let u=t[o];if(-1===u)a.length&&a.splice(0,1);else{if(1!==u){e.OpLog&&e.OpLog(`Update.$pop: Invalid direction value [${u}] for field [${o}], should be -1 or 1.`),n=!1;continue}a.length&&a.pop()}!1!==e.SetValue(r,o,a)||(e.OpLog&&Engine.OpLog(`Update.$pop: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$pop: ${r.message}`),r}}}}},9164:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o);if("a"!==e.ShortType(a)){e.OpLog&&e.OpLog(`Update.$pullAll: The field [${o}] must be an array.`),n=!1;continue}let u=t[o];if("a"===e.ShortType(u)){for(let e=a.length-1;e>=0;e--)u.includes(a[e])&&a.splice(e,1);!1!==e.SetValue(r,o,a)||(e.OpLog&&Engine.OpLog(`Update.$pullAll: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1)}else e.OpLog&&e.OpLog("Update.$pullAll: The values to pull must be an array."),n=!1}return n}catch(r){throw e.OpError&&e.OpError(`Update.$pullAll: ${r.message}`),r}}}}},6396:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o);if("a"!==e.ShortType(a)){e.OpLog&&e.OpLog(`Update.$push: The field [${o}] must be an array.`),n=!1;continue}let u=t[o];a.push(u),!1!==e.SetValue(r,o,a)||(e.OpLog&&Engine.OpLog(`Update.$push: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1)}return!0}catch(r){throw e.OpError&&e.OpError(`Update.$push: ${r.message}`),r}}}}},5730:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0,o=new Date;for(let a in t){let u=t[a],i=e.ShortType(u),p=null;if("b"===i)!0===u&&(p=o.toISOString());else{if("o"!==i){e.OpLog&&e.OpLog(`Update.$currentDate: The date dpecification of [${JSON.stringify(u)}] for [${a}] is invalid.`),n=!1;continue}if("string"==typeof u.$type)if(u=u.$type,"timestamp"===u)p=o.getTime();else{if("date"!==u){e.OpLog&&e.OpLog(`Update.$currentDate: Unknown date dpecification [${u}] for [${a}] is invalid.`),n=!1;continue}p=o.toDateString()}}null===p||!1!==e.SetValue(r,a,p)||(e.OpLog&&e.OpLog(`Update.$currentDate: Setting the value of [${a}] to [${JSON.stringify(p)}] failed.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$currentDate: ${r.message}`),r}}}}},7095:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o),u=e.AsNumber(t[o]);null!==u?(a+=u,!1!==e.SetValue(r,o,a)||(e.OpLog&&e.OpLog(`Update.$inc: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1)):(e.OpLog&&e.OpLog(`Update.$inc: This operator requires a numeric value but found [${t[o]}] instead at [${o}].`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$inc: ${r.message}`),r}}}}},4178:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o),u=e.AsNumber(t[o]);if(null!==u){if(u>a&&!1===e.SetValue(r,o,u)){e.OpLog&&e.OpLog(`Update.$max: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1;continue}}else e.OpLog&&e.OpLog(`Update.$max: This operator requires a numeric value but found [${t[o]}] instead at [${o}].`),n=!1}return n}catch(r){throw e.OpError&&e.OpError(`Update.$max: ${r.message}`),r}}}}},7863:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o),u=e.AsNumber(t[o]);if(null!==u){if(u<a&&!1===e.SetValue(r,o,u)){e.OpLog&&e.OpLog(`Update.$min: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1;continue}}else e.OpLog&&e.OpLog(`Update.$min: This operator requires a numeric value but found [${t[o]}] instead at [${o}].`),n=!1}return n}catch(r){throw e.OpError&&e.OpError(`Update.$min: ${r.message}`),r}}}}},4581:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o),u=e.AsNumber(t[o]);null!==u?(a*=u,!1!==e.SetValue(r,o,a)||(e.OpLog&&e.OpLog(`Update.$mul: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1)):(e.OpLog&&e.OpLog(`Update.$mul: This operator requires a numeric value but found [${t[o]}] instead at [${o}].`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$mul: ${r.message}`),r}}}}},6818:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=t[o],u=e.GetValue(r,o),i=null;i=e.SetValue(r,o,void 0),!1!==i?(i=e.SetValue(r,a,u),!1!==i||(e.OpLog&&e.OpLog(`Update.$rename: Setting the value of [${a}] to [${JSON.stringify(u)}] failed.`),n=!1)):(e.OpLog&&e.OpLog(`Update.$rename: Unsetting the value of [${o}] failed.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$rename: ${r.message}`),r}}}}},2652:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=t[o];!1!==e.SetValue(r,o,a)||(e.OpLog&&Engine.OpLog(`Update.$set: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$set: ${r.message}`),r}}}}},7101:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t)!1!==e.SetValue(r,o,void 0)||(Engine.OpLog&&Engine.OpLog(`Update.$unset: Unsetting the value of [${o}] failed.`),n=!1);return n}catch(r){throw e.OpError&&e.OpError(`Update.$unset: ${r.message}`),r}}}}},986:(e,r,t)=>{e.exports=function(e={}){void 0===e.OpLog&&(e.OpLog=null),void 0===e.OpError&&(e.OpError=null);let r={};return r.Settings=e,r.QueryOperators={$eq:t(3374)(r),$ne:t(3490)(r),$gt:t(5132)(r),$gte:t(7588)(r),$lt:t(2207)(r),$lte:t(424)(r),$in:t(4038)(r),$nin:t(7879)(r),$and:t(3209)(r),$or:t(7577)(r),$nor:t(5809)(r),$not:t(1008)(r),$regex:t(6940)(r),$elemMatch:t(3999)(r),$size:t(4950)(r),$all:t(2863)(r),$exists:t(5611)(r),$type:t(6475)(r),$ImplicitEq:t(8469)(r),$eqx:t(2239)(r),$nex:t(4105)(r),$query:t(8250)(r),$noop:t(3565)(r)},r.UpdateOperators={$set:t(2652)(r),$unset:t(7101)(r),$rename:t(6818)(r),$inc:t(7095)(r),$min:t(7863)(r),$max:t(4178)(r),$mul:t(4581)(r),$currentDate:t(5730)(r),$addToSet:t(5778)(r),$pop:t(7585)(r),$push:t(6396)(r),$pullAll:t(9164)(r)},r.Query=t(2250)(r),r.Project=t(1896)(r),r.Update=t(4609)(r),r.Parse=t(4074)(r),r.Format=t(1330)(r),r.SplitPath=t(5415)(r),r.JoinPaths=t(2345)(r),r.GetValue=t(8231)(r),r.SetValue=t(8396)(r),r.Flatten=t(5087)(r),r.Expand=t(3903)(r),r.Hybridize=t(8824)(r),r.Unhybridize=t(7159)(r),r.LooseEquals=function(e,t){return r.QueryOperators.$eqx.Query(e,t)},r.StrictEquals=function(e,t){return r.QueryOperators.$eq.Query(e,t)},r.Clone=function(e){return JSON.parse(JSON.stringify(e))},r.SafeClone=t(4978)(r),r.ShortType=t(5020)(r),r.BsonType=t(4255)(r),r.OpLog=e.OpLog,r.OpError=e.OpError,r.AsNumber=function(e){try{if(!e)return null;let r=Number(e);return isNaN(r)?null:r}catch(e){return null}},r.AsDate=function(e){try{if(!e)return null;let r=new Date(e);return isNaN(r)?null:r}catch(e){return null}},r.IsQuery=function(e){if("o"!==r.ShortType(e))return!1;for(let t in e)if(void 0!==r.QueryOperators[t])return!0;return!1},r}},4255:e=>{e.exports=function(e){return function(e,r=!1){let t=this.ShortType(e);if("b"===t)return r?"bool":8;if("n"===t)return e.toString().includes(".")?r?"double":1:Number.isSafeInteger(e)?r?"int":16:r?"long":18;if("s"===t)return r?"string":2;if("l"===t)return r?"null":10;if("o"===t)return r?"object":3;if("a"===t)return r?"array":4;if("r"===t)return r?"regex":11;if("f"===t);else{if("y"===t)return r?"symbol":14;if("u"===t)return r?"undefined":6}return null}}},3903:e=>{e.exports=function(e){return function(r){try{if("o"!==e.ShortType(r))throw new Error("Document must be an object.");let t={};for(let n in r)e.SetValue(t,n,r[n]);return t}catch(r){throw e.OpError&&e.OpError("Expand: "+r.message),r}}}},5087:e=>{e.exports=function(e){return function(r){try{let t={};function n(r,o){let a=e.ShortType(r);if("o"===a)for(let e in r){let t=o;t?t+="."+e:t=e,n(r[e],t)}else if("a"===a)for(let e=0;e<r.length;e++){let t=o;t?t+="."+e:t=""+e,n(r[e],t)}else t[o]=r}if(!"oa".includes(e.ShortType(r)))throw new Error("Document must be an object or array.");return n(r,""),t}catch(o){throw e.OpError&&e.OpError("Flatten: "+o.message),o}}}},1330:(e,r,t)=>{t(986),e.exports=function(e){function r(e,t,n,o=null){let a="";if(void 0===e);else if("boolean"==typeof e)a+=e.toString();else if("number"==typeof e)a+=e.toString();else if("bigint"==typeof e)a+=e.toString();else if("string"==typeof e){let r=e.toString();n.literal_quote&&(r=r.replace(n.literal_quote,"\\"+n.literal_quote)),a+=`${n.literal_quote}${r}${n.literal_quote}`}else if("symbol"==typeof e);else if("function"==typeof e);else if("object"==typeof e)if(null===e)a+="null";else if(Array.isArray(e)){n.braces_on_own_line&&(a+=n.eol_char,a+=n.tab_char.repeat(t)),n.eol_char?a+="["+n.eol_char:a+="["+n.space_char;for(let o=0;o<e.length;o++)a+=n.tab_char.repeat(t+1),a+=r(e[o],t+1,n,"array-element"),o<e.length-1||n.liberal_commas?n.eol_char?a+=","+n.eol_char:a+=","+n.space_char:n.eol_char&&(a+=n.eol_char);a+=n.tab_char.repeat(t),n.eol_char||(a+=n.space_char),a+="]"}else{t>0&&n.braces_on_own_line&&(a+=n.eol_char,a+=n.tab_char.repeat(t)),n.eol_char?a+="{"+n.eol_char:a+="{"+n.space_char;let o=Object.keys(e),u=0;o.map((e=>{e.length>u&&(u=e.length)}));for(let i=0;i<o.length;i++){let p=o[i];a+=n.tab_char.repeat(t+1),n.always_quote_identifiers?a+=`${n.identifier_quote}${p}${n.identifier_quote}`:a+=p,a+=":",n.align_values&&(a+=" ".repeat(u-p.length)),a+=n.space_char,a+=r(e[p],t+1,n,"field-value"),i<o.length-1||n.liberal_commas?n.eol_char?a+=","+n.eol_char:a+=","+n.space_char:n.eol_char&&(a+=n.eol_char)}a+=n.tab_char.repeat(t),n.eol_char||(a+=n.space_char),a+="}"}return a}return function(t,n=!1,o=!1){try{let e={identifier_quote:'"',always_quote_identifiers:!0,literal_quote:'"',eol_char:"",tab_char:"",space_char:""};return n&&(e.eol_char="\n",e.tab_char="    ",e.space_char=" ",o&&(e.always_quote_identifiers=!1,e.liberal_commas=!0,e.align_values=!0,e.braces_on_own_line=!0)),r(t,0,e)}catch(r){throw e.OpError&&e.OpError("Format: "+r.message),r}}}},8231:(e,r,t)=>{t(986),e.exports=function(e){return function r(t,n){try{switch(e.ShortType(n)){case"u":case"l":return t;case"n":case"s":break;default:throw new Error(`Path is invalid [${JSON.stringify(n)}].`)}if(0===n.length)return t;let o=e.SplitPath(n),a=t;for(let t=0;t<o.length;t++){let n=o[t],u=e.ShortType(n),i=e.ShortType(a);if("a"===i){if("n"===u){if(n<0&&(n=a.length+n),n<0)return;if(n>=a.length)return;a=a[n];continue}{let e=[],n=o.slice(t).join(".");for(let t=0;t<a.length;t++){let o=r(a[t],n);e.push(o)}return e}}if("o"!==i)return;a=a[n]}return a}catch(r){throw e.OpError&&e.OpError("GetValue: "+r.message),r}}}},8824:e=>{e.exports=function(e){return function(r){let t={};for(let n in r)switch(e.ShortType(r[n])){case"b":case"n":case"s":case"l":t[n]=r[n];break;case"o":t[n]=JSON.stringify({type:"o",value:r[n]});break;case"a":t[n]=JSON.stringify({type:"a",value:r[n]});break;case"r":t[n]=JSON.stringify({type:"r",flags:r[n].flags,source:r[n].source});break;case"e":t[n]=JSON.stringify({type:"e",message:r[n].message});break;case"f":t[n]=JSON.stringify({type:"f",source:r[n].toString()});break;case"y":t[n]=JSON.stringify({type:"y",source:r[n].toString()});break;case"u":t[n]=JSON.stringify({type:"u"})}return t}}},2345:e=>{e.exports=function(e){return function(){try{let r=[];for(let t=0;t<arguments.length;t++){let n=arguments[t];switch(e.ShortType(n)){case"u":case"l":continue;case"n":n=[""+n];break;case"s":case"a":break;default:throw new Error(`Path segment is invalid [${JSON.stringify(n)}].`)}"string"==typeof n&&(n=e.SplitPath(n));let o=[];for(let r=0;r<n.length;r++){let t=e.SplitPath(n[r]);o.push(...t)}r.push(...o)}return r.join(".")}catch(r){throw e.OpError&&e.OpError("JoinPaths: "+r.message),r}}}},4074:(e,r,t)=>{t(986),e.exports=function(e){function r(e){for(;e.length;){if("["===e[0].token){e.shift();let n=[];for(;"]"!==e[0].token;)n.push(r(e));return e.shift(),t(e),n}if("{"===e[0].token){e.shift();let n={};for(;"}"!==e[0].token;){let t=e.shift(),o=e.shift();if("literal"!==t.type&&"string"!==t.type)throw new Error(`At position [${t.at}]: Expected literal, found ${t.type} '${t.token}' instead.`,t);if(":"!==o.token)throw new Error(`At position [${o.at}]: Expected ':', found '${o.token}' instead.`,o);n[t.token]=r(e)}return e.shift(),t(e),n}{let r=e[0].token;return"literal"===e[0].type&&("null"===r.toLowerCase()?r=null:"true"===r.toLowerCase()?r=!0:"false"===r.toLowerCase()&&(r=!1),!isNaN(parseFloat(r))&&isFinite(r)&&(r=parseFloat(r))),e.shift(),t(e),r}}}function t(e){e.length&&","===e[0].token&&e.shift()}return function(t){try{let e=function(e){let r=[],t="[]{}:,",n=0;for(;n<e.length;){let o=e.charAt(n);if(" \t\n".includes(o))n++;else if(t.includes(o))r.push({token:o,type:"delimiter",at:n}),n++;else if("'\"".includes(o)){let t=n;n++;let a="";for(;n<e.length;){let r=e.charAt(n);if(r===o){n++;break}"\\"===r&&(n++,r=n<e.length?e.charAt(n):""),a+=r,n++}r.push({token:a,type:"string",at:t})}else{let a=n;n++;let u=o;for(;n<e.length;){let r=e.charAt(n);if(" \t\n".includes(r)||t.includes(r)||"'\"".includes(r))break;u+=r,n++}r.push({token:u,type:"literal",at:a})}}return r}(t);return r(e)}catch(r){throw e.OpError&&e.OpError("Parse: "+r.message),r}}}},1896:e=>{e.exports=function(e){return function(r,t){if("o"!==e.ShortType(r))return e.OpLog&&e.OpLog("Projection: The Document parameter must be an object."),null;r=e.Clone(r);let n=e.ShortType(t);if(!0==="lu".includes(n))return r;if("o"!==n)return e.OpLog&&e.OpLog("Projection: The Projection parameter must be an object."),null;t=e.Clone(t);let o="",a=!0;for(let r in t){let n=t[r];if("_id"===r)0===n&&(a=!1),delete t[r];else if(1===n){if("exclude"===o)return e.OpLog&&e.OpLog("Update: Cannot combine inclusion and exclusion operators in the same update."),null;o="include"}else if(0===n){if("include"===o)return e.OpLog&&e.OpLog("Update: Cannot combine inclusion and exclusion operators in the same update."),null;o="exclude"}}""===o&&(o=a?"include":"exclude");let u=null;if("exclude"===o){u=e.Clone(r);for(let r in t)!1!==e.SetValue(u,r,void 0)||e.OpLog&&e.OpLog(`Projection: Failed to unset the field [${field}] in the projection.`)}else if("include"===o){u={_id:r._id};for(let n in t){let t=e.GetValue(r,n);!1!==e.SetValue(u,n,t)||e.OpLog&&e.OpLog(`Projection: Failed to set the field [${field}] in the projection.`)}}return!1===a&&delete u._id,u}}},2250:e=>{e.exports=function(e){return function(r,t,n=""){if("o"!==e.ShortType(r))return e.OpLog&&e.OpLog("Query: The Document parameter must be an object."),!1;if("o"!==e.ShortType(t))return e.OpLog&&e.OpLog("Query: The Criteria parameter must be an object."),!1;{let r=e.SplitPath(n);n=null===r?"":r.join(".")}if(""===n&&0===Object.keys(t).length)return e.OpLog&&e.OpLog("Query: An empty query object {} matches everything."),!0;for(let o in t)if(void 0!==e.QueryOperators[o]){if(""===n&&!e.QueryOperators[o].TopLevel)return e.OpLog&&e.OpLog(`Query: Operator [${o}] cannot appear at the top level of a query. Only logical operators can appear at the top level of a query.`),!1;let a=t[o];if(void 0===a)return e.OpLog&&e.OpLog(`Query: Operator [${o}] cannot be set to undefined. Use $exists to test if a field exists in the document.`),!1;if(!1===e.QueryOperators[o].Query(r,a,n))return e.OpLog&&e.OpLog(`Query: Operator [${o}] returned false at [${n}].`),!1}else{let a=t[o],u=e.JoinPaths(n,o),i=!1;if(e.IsQuery(a))i=e.Query(r,a,u);else{if(void 0===a)return e.OpLog&&e.OpLog("Query: The implicit $eq operator cannot be set to undefined. Use $exists to test if a field exists in the document."),!1;i=e.QueryOperators.$ImplicitEq.Query(r,a,u)}if(!1===i)return!1}return!0}}},4978:e=>{e.exports=function(e){return function(r,t){try{switch(e.ShortType(t)){case"l":case"u":t=[];break;case"s":t=[t];break;case"a":break;default:throw new Error("The Exceptions parameter must be a document path or array of paths in dot notation.")}function n(r,o){let a=e.ShortType(r);switch(a){case"b":case"n":case"s":case"l":case"r":case"e":case"f":case"y":case"u":return r;case"o":{let e={};for(let a in r){let u=o;u?u+="."+a:u=a,t.includes(u)?e[a]=r[a]:e[a]=n(r[a],u)}return e}case"a":{let e=[];for(let a=0;a<r.length;a++){let u=o;u?u+="."+a:u=""+a,t.includes(u)?e.push(r[a]):e.push(n(r[a],u))}return e}default:throw new Error(`Unrecognized short type [${a}] at [${o}].`)}}return n(r,"")}catch(o){throw e.OpError&&e.OpError("SafeClone: "+o.message),o}}}},8396:e=>{e.exports=function(e){return function r(t,n,o){try{switch(e.ShortType(t)){case"o":case"a":break;default:throw new Error("Document must be an object or array.")}switch(e.ShortType(n)){case"u":case"l":n="";break;case"n":case"s":break;default:throw new Error(`Path is invalid [${JSON.stringify(n)}].`)}if(0===n.length)return e.OpLog&&e.OpLog("SetValue: Path is empty."),!1;let a=e.SplitPath(n),u=t;for(let t=0;t<a.length;t++){let i=a[t],p=e.ShortType(i),l=e.ShortType(u);if("a"===l){if("n"===p){if(i<0&&(i=u.length+i),i<0)return e.OpLog&&e.OpLog(`SetValue: Disallowed negative array index [${i}] in path [${n}].`),!1;if(t===a.length-1)return u[i]=o,!0;if(void 0===u[i]){let r=e.ShortType(a[t+1]);u[i]="n"===r?[]:{}}u=u[i];continue}{let e=a.slice(t).join(".");for(let t=0;t<u.length;t++)if(!1===r(u[t],e,o))return!1;return!0}}if("o"!==l)throw new Error(`The element [${i}] of the path [${n}] must reference an object or array.`);if(t===a.length-1)return u[i]=o,!0;if(void 0!==u[i])u=u[i];else{let r=e.ShortType(a[t+1]);u[i]="n"===r?[]:{},u=u[i]}}return!0}catch(r){throw e.OpError&&e.OpError("SetValue: "+r.message),r}}}},5020:e=>{e.exports=function(e){return function(e){let r=typeof e;if("boolean"===r)return"b";if("number"===r)return"n";if("string"===r)return"s";if("object"===r)return null===e?"l":Array.isArray(e)?"a":e instanceof RegExp?"r":e instanceof Error?"e":"o";if("function"===r)return"f";if("symbol"===r)return"y";if("undefined"===r)return"u";throw new Error(`Unsupported data type [${r}].`)}}},5415:e=>{e.exports=function(e){return function(r){try{switch(e.ShortType(r)){case"u":case"l":return[];case"n":r=""+r;break;case"s":break;default:throw new Error(`Path is invalid [${JSON.stringify(r)}].`)}if(0===r.length)return[];let t=r.split(".");for(let r=0;r<t.length;r++){let n=t[r];null!==e.AsNumber(n)&&(n=Number(n)),t[r]=n}return t}catch(r){throw e.OpError&&e.OpError("SplitPath: "+r.message),r}}}},7159:e=>{e.exports=function(e){return function(r){let t={};for(let n in r)switch(e.ShortType(r[n])){case"b":case"n":case"l":t[n]=r[n];break;case"s":try{let e=JSON.parse(r[n]);switch(e.type){case"o":case"a":t[n]=e.value;break;case"r":t[n]=new RegExp(e.source,e.flags);break;case"e":t[n]=new Error(r[n].message);break;case"f":t[n]=new Function(r[n].source);break;case"y":t[n]=Symbol(r[n].source);break;case"u":t[n]=void 0}break}catch(e){}t[n]=r[n]}return t}}},4609:e=>{e.exports=function(e){return function(r,t){if("o"!==e.ShortType(r))return e.OpLog&&e.OpLog("Update: The Document parameter must be an object."),null;r=e.Clone(r);let n=e.ShortType(t);if(!0==="lu".includes(n))return r;if("o"!==n)return e.OpLog&&e.OpLog("Update: The Update parameter must be an object."),null;for(let n in t)void 0!==e.UpdateOperators[n]?!1===e.UpdateOperators[n].Update(r,t[n])&&e.OpLog&&e.OpLog(`Update: The update operator [${n}] failed.`):e.OpLog&&e.OpLog(`Update: Unknown update operator [${n}] encountered.`);return r}}}},r={};return function t(n){var o=r[n];if(void 0!==o)return o.exports;var a=r[n]={exports:{}};return e[n](a,a.exports,t),a.exports}(986)})()));