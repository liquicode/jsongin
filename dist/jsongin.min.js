!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.jsongin=r():e.jsongin=r()}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var e={2863:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"o",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o);if("a"!==a&&(o=[o]),"a"!==a)return e.OpLog&&e.OpLog(`$all: document requires an array but found type [${a}] instead at [${n}].`),!1;let i=e.ShortType(t);if("a"!==i)return e.OpLog&&e.OpLog(`$all: match requires an array but found type [${i}] instead at [${n}].`),!1;for(let a=0;a<t.length;a++){let u=!1,p=e.ShortType(t[a]);if("bnsl".includes(p)?u=o.includes(t[a]):"o"===p?u=e.Query(r,t[a],n):e.OpLog&&e.OpLog(`$all: sub-match requires "bnslo" but found type [${i}] instead at [${n}].`),!1===u)return!1}return!0}catch(r){throw e.OpError&&e.OpError(`Query.$all: ${r.message}`),r}}}}},3999:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"o",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o);if("a"!==a)return e.OpLog&&e.OpLog(`$elemMatch: document requires an array but found type [${a}] instead at [${n}].`),!1;let i=e.ShortType(t);if("o"!==i)return e.OpLog&&e.OpLog(`$elemMatch: match requires an object but found type [${i}] instead at [${n}].`),!1;for(let a=0;a<o.length;a++){let o=e.JoinPaths(n,a);if(!0===e.Query(r,t,o))return!0}return!1}catch(r){throw e.OpError&&e.OpError(`Query.$elemMatch: ${r.message}`),r}}}}},4950:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"n",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o);if("a"!==a)return e.OpLog&&e.OpLog(`$size: requires an array but found type [${a}] instead at [${n}].`),!1;let i=e.ShortType(t);return"n"!==i?(e.OpLog&&e.OpLog(`$size: requires a number but found type [${i}] instead at [${n}].`),!1):o.length===t}catch(r){throw e.OpError&&e.OpError(`Query.$size: ${r.message}`),r}}}}},3374:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),i=t,u=e.ShortType(i);if("bnslru".includes(u)&&u===a)return o===i;if("lu".includes(u)&&"lu".includes(a))return!0;if("o"===u&&"o"===a)return!0==(JSON.stringify(i)===JSON.stringify(o));if("a"===u&&"a"===a){let e=JSON.stringify(i),r=e===JSON.stringify(o);if(!0===r)return!0;for(let t=0;t<o.length&&(r=e===JSON.stringify(o[t]),!0!==r);t++);return!0===r}return e.OpLog&&e.OpLog(`$eq: cannot compare [${u}] type with [${a}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$eq: ${r.message}`),r}}}}},5132:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bns",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),i=t,u=e.ShortType(i);if("bns".includes(u)&&u===a)return o>i;if("a".includes(a)){let e=!1;for(let r=0;r<o.length;r++)if(e=o[r]>i,!0===e)return!0;return!1}return e.OpLog&&e.OpLog(`$gt: cannot compare [${u}] type with [${a}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$gt: ${r.message}`),r}}}}},7588:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnslu",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),i=t,u=e.ShortType(i);if("bns".includes(u)&&u===a)return o>=i;if("lu".includes(u)&&"lu".includes(a))return!0;if("a".includes(a)){let e=!1;for(let r=0;r<o.length;r++)if(e=o[r]>=i,!0===e)return!0;return!1}return e.OpLog&&e.OpLog(`$gte: cannot compare [${u}] type with [${a}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$gte: ${r.message}`),r}}}}},4038:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"a",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),i=t,u=e.ShortType(i);if("a"!==u)return e.OpLog&&e.OpLog(`$in: expected an array but found a type [${u}] instead at [${n}].`),!1;function p(e,r,t){if("r"===e.ShortType(t)){for(let e=0;e<r.length;e++)if(t.test(r[e]))return!0}else if(r.includes(t))return!0;return!1}if("a"===a){for(let l=0;l<i.length;l++)if(p(e,o,i[l]))return!0}else if("bnslou".includes(a)&&p(e,i,o))return!0;return e.OpLog&&e.OpLog(`$in: cannot compare [${u}] type with [${a}] type at [${n}].`),!1}catch(s){throw e.OpError&&e.OpError(`Query.$in: ${s.message}`),s}}}}},2207:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bns",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),i=t,u=e.ShortType(i);if("bns".includes(u)&&u===a)return o<i;if("a".includes(a)){let e=!1;for(let r=0;r<o.length;r++)if(e=o[r]<i,!0===e)return!0;return!1}return e.OpLog&&e.OpLog(`$lt: cannot compare [${u}] type with [${a}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$lt: ${r.message}`),r}}}}},424:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnslu",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),i=t,u=e.ShortType(i);if("bns".includes(u)&&u===a)return o<=i;if("lu".includes(u)&&"lu".includes(a))return!0;if("a".includes(a)){let e=!1;for(let r=0;r<o.length;r++)if(e=o[r]<=i,!0===e)return!0;return!1}return e.OpLog&&e.OpLog(`$lte: cannot compare [${u}] type with [${a}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$lte: ${r.message}`),r}}}}},3490:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloau",Query:function(r,t,n=""){return!e.QueryOperators.$eq.Query(r,t,n)}}}},7879:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"a",Query:function(r,t,n=""){return!e.QueryOperators.$in.Query(r,t,n)}}}},5611:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),i=e.ShortType(t);if("b"!==i)return e.OpLog&&e.OpLog(`$exists: requires a boolean but found type [${i}] instead at [${n}].`),!1;if(!0===t){if("u"!==a)return!0}else if("u"===a)return!0;return!1}catch(r){throw e.OpError&&e.OpError(`Query.$exists: ${r.message}`),r}}}}},6475:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"nsa",Query:function(r,t,n=""){try{let o=e.GetValue(r,n);"a"!==e.ShortType(o)&&(o=[o]);let a=e.ShortType(t);"a"!==a&&(t=[t]);for(let r=0;r<t.length;r++){let i=t[r];if(a=e.ShortType(i),"n"===a){for(let r=0;r<o.length;r++)if(i===e.BsonType(o[r],!1))return!0}else{if("s"!==a)return e.OpLog&&e.OpLog(`$type: requires a number or string but found type [${a}] instead at [${n}].`),!1;for(let r=0;r<o.length;r++){let t=e.BsonType(o[r],!0);if(i===t)return!0;if("number"===i&&["int","long","double","decimal"].includes(t))return!0}}}return!1}catch(r){throw e.OpError&&e.OpError(`Query.$type: ${r.message}`),r}}}}},6940:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"sr",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=(e.ShortType(o),t),i=e.ShortType(a);return"sr".includes(i)?("s"===i&&(a=new RegExp(a)),a.test(o)):(e.OpLog&&e.OpLog(`$regex: requires regexp or string but found [${i}] instead at [${n}].`),!1)}catch(r){throw e.OpError&&e.OpError(`Query.$regex: ${r.message}`),r}}}}},8469:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),a=e.ShortType(o),i=t,u=e.ShortType(i),p=e.IsQuery(i),l=!1;if("bnslu".includes(a)&&"bnslu".includes(u))return l=e.QueryOperators.$eq.Query(r,i,n),l;if("bnslu".includes(a)&&"a".includes(u))return e.OpLog&&e.OpLog(`ImplicitEq: cannot compare [${u}] type with [${a}] type at [${n}].`),!1;if("bnslu".includes(a)&&"o".includes(u))return p?(l=e.Query(r,i,n),l):(e.OpLog&&e.OpLog(`ImplicitEq: requires query when comparing against [${a}] type with [${a}] type at [${n}].`),!1);if("a".includes(a)&&"bnslu".includes(u))return l=o.includes(i),l;if("a".includes(a)&&"o".includes(u)){for(let t=0;t<o.length;t++){let o=e.JoinPaths(n,t);if(l=p?e.Query(r,i,o):e.QueryOperators.$eq.Query(r,i,o),!0===l)return!0}return!1}if("a".includes(a)&&"a".includes(u))return l=e.QueryOperators.$eq.Query(r,i,n),l;if("a".includes(a)&&"r".includes(u)){for(let t=0;t<o.length;t++){let o=e.JoinPaths(n,t);if(l=e.QueryOperators.$regex.Query(r,i,o),!1===l)return!1}return!0}return"o".includes(a)&&"o".includes(u)?p?(l=e.Query(r,i,n),l):(l=e.QueryOperators.$eq.Query(r,i,n),l):"s".includes(a)&&"r".includes(u)?(l=e.QueryOperators.$regex.Query(r,i,n),l):(e.OpLog&&e.OpLog(`ImplicitEq: cannot compare [${u}] type with [${a}] type at [${n}].`),!1)}catch(r){throw e.OpError&&e.OpError(`Query.$ImplicitEq: ${r.message}`),r}}}}},2239:e=>{e.exports=e.exports=function(e){let r={Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(t,n,o=""){try{let a=e.GetValue(t,o),i=e.ShortType(a),u=n,p=e.ShortType(u);if("bns".includes(p)&&"bns".includes(i))return a==u;if("lu".includes(p)&&"lu".includes(i))return!0;if("bnslu".includes(p)||"bnslu".includes(i))return e.OpLog&&e.OpLog(`Query.$eqx: cannot compare primitive types to non-primitive types at [${o}].`),!1;if("o"===p&&"o"===i){for(let e in a)if(!1===r.Query(a[e],u[e],""))return!1;return!0}if("a"===p&&"a"===i){if(u.length!==a.length)return!1;let e=[...a];for(let t=0;t<u.length;t++){let n=!1;for(let o=0;o<e.length;o++)if(r.Query(u[t],e[o],"")){n=!0,e.splice(o,1);break}if(!1===n)return!1}return!0}return e.OpLog&&e.OpLog(`Query.$eqx: cannot compare [${p}] type with [${value_type}] type at [${o}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$eqx: ${r.message}`),r}}};return r}},4105:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloau",Query:function(r,t,n=""){return!e.QueryOperators.$eqx.Query(r,t,n)}}}},3565:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(r,t,n=""){return e.OpLog&&e.OpLog(`$noop: always returns true at [${n}].`),!0},ToMongoQuery:function(e){},ToSql:function(e){return""}}}},8250:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(e,r,t=""){return!0},ToMongoQuery:function(e){},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},3209:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(r,t,n){try{let o=e.ShortType(t);if("a"!==o)return e.OpLog&&e.OpLog(`$and: requires an array but found type [${o}] instead at [${n}].`),!1;for(let o=0;o<t.length;o++)if(!1===e.Query(r,t[o],n))return!1;return!0}catch(r){throw e.OpError&&e.OpError(`Query.$and: ${r.message}`),r}}}}},5809:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(r,t,n=""){try{let o=e.ShortType(t);if("a"!==o)return e.OpLog&&e.OpLog(`$nor: requires an array but found type [${o}] instead at [${n}].`),!1;for(let o=0;o<t.length;o++)if(!0===e.Query(r,t[o],n))return!1;return!0}catch(r){throw e.OpError&&e.OpError(`Query.$nor: ${r.message}`),r}}}}},1008:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"or",Query:function(r,t,n=""){try{let o=t,a=e.ShortType(o),i=!1;return"o"===a?i=e.Query(r,o,n):"r"===a?i=e.QueryOperators.$regex.Query(r,o,n):e.OpLog&&e.OpLog(`$not: requires an object or regexp but found type [${a}] instead at [${n}].`),!i}catch(r){throw e.OpError&&e.OpError(`Query.$not: ${r.message}`),r}}}}},7577:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(r,t,n=""){try{let o=e.ShortType(t);if("a"!==o)return e.OpLog&&e.OpLog(`$or: requires an array but found type [${o}] instead at [${n}].`),!1;for(let o=0;o<t.length;o++)if(!0===e.Query(r,t[o],n))return!0;return!1}catch(r){throw e.OpError&&e.OpError(`Query.$or: ${r.message}`),r}}}}},5778:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o);"a"===e.ShortType(a)?a.includes(t[o])||(a.push(t[o]),!1!==e.SetValue(r,o,a)||(e.OpLog&&Engine.OpLog(`Update.$addToSet: Setting the value of [${o}] to [${JSON.stringify(value)}] failed.`),n=!1)):(e.OpLog&&e.OpLog(`Update.$addToSet: The field [${o}] must be an array.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$addToSet: ${r.message}`),r}}}}},7585:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o);if("a"!==e.ShortType(a)){e.OpLog&&e.OpLog(`Update.$pop: The field [${o}] must be an array.`),n=!1;continue}let i=t[o];if(-1===i)a.length&&a.splice(0,1);else{if(1!==i){e.OpLog&&e.OpLog(`Update.$pop: Invalid direction value [${i}] for field [${o}], should be -1 or 1.`),n=!1;continue}a.length&&a.pop()}!1!==e.SetValue(r,o,a)||(e.OpLog&&Engine.OpLog(`Update.$pop: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$pop: ${r.message}`),r}}}}},9164:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o);if("a"!==e.ShortType(a)){e.OpLog&&e.OpLog(`Update.$pullAll: The field [${o}] must be an array.`),n=!1;continue}let i=t[o];if("a"===e.ShortType(i)){for(let e=a.length-1;e>=0;e--)i.includes(a[e])&&a.splice(e,1);!1!==e.SetValue(r,o,a)||(e.OpLog&&Engine.OpLog(`Update.$pullAll: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1)}else e.OpLog&&e.OpLog("Update.$pullAll: The values to pull must be an array."),n=!1}return n}catch(r){throw e.OpError&&e.OpError(`Update.$pullAll: ${r.message}`),r}}}}},6396:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o);if("a"!==e.ShortType(a)){e.OpLog&&e.OpLog(`Update.$push: The field [${o}] must be an array.`),n=!1;continue}let i=t[o];a.push(i),!1!==e.SetValue(r,o,a)||(e.OpLog&&Engine.OpLog(`Update.$push: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1)}return!0}catch(r){throw e.OpError&&e.OpError(`Update.$push: ${r.message}`),r}}}}},5730:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0,o=new Date;for(let a in t){let i=t[a],u=e.ShortType(i),p=null;if("b"===u)!0===i&&(p=o.toISOString());else{if("o"!==u){e.OpLog&&e.OpLog(`Update.$currentDate: The date dpecification of [${JSON.stringify(i)}] for [${a}] is invalid.`),n=!1;continue}if("string"==typeof i.$type)if(i=i.$type,"timestamp"===i)p=o.getTime();else{if("date"!==i){e.OpLog&&e.OpLog(`Update.$currentDate: Unknown date dpecification [${i}] for [${a}] is invalid.`),n=!1;continue}p=o.toDateString()}}null===p||!1!==e.SetValue(r,a,p)||(e.OpLog&&e.OpLog(`Update.$currentDate: Setting the value of [${a}] to [${JSON.stringify(p)}] failed.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$currentDate: ${r.message}`),r}}}}},7095:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o),i=e.AsNumber(t[o]);null!==i?(a+=i,!1!==e.SetValue(r,o,a)||(e.OpLog&&e.OpLog(`Update.$inc: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1)):(e.OpLog&&e.OpLog(`Update.$inc: This operator requires a numeric value but found [${t[o]}] instead at [${o}].`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$inc: ${r.message}`),r}}}}},4178:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o),i=e.AsNumber(t[o]);if(null!==i){if(i>a&&!1===e.SetValue(r,o,i)){e.OpLog&&e.OpLog(`Update.$max: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1;continue}}else e.OpLog&&e.OpLog(`Update.$max: This operator requires a numeric value but found [${t[o]}] instead at [${o}].`),n=!1}return n}catch(r){throw e.OpError&&e.OpError(`Update.$max: ${r.message}`),r}}}}},7863:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o),i=e.AsNumber(t[o]);if(null!==i){if(i<a&&!1===e.SetValue(r,o,i)){e.OpLog&&e.OpLog(`Update.$min: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1;continue}}else e.OpLog&&e.OpLog(`Update.$min: This operator requires a numeric value but found [${t[o]}] instead at [${o}].`),n=!1}return n}catch(r){throw e.OpError&&e.OpError(`Update.$min: ${r.message}`),r}}}}},4581:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=e.GetValue(r,o),i=e.AsNumber(t[o]);null!==i?(a*=i,!1!==e.SetValue(r,o,a)||(e.OpLog&&e.OpLog(`Update.$mul: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1)):(e.OpLog&&e.OpLog(`Update.$mul: This operator requires a numeric value but found [${t[o]}] instead at [${o}].`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$mul: ${r.message}`),r}}}}},6818:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=t[o],i=e.GetValue(r,o),u=null;u=e.SetValue(r,o,void 0),!1!==u?(u=e.SetValue(r,a,i),!1!==u||(e.OpLog&&e.OpLog(`Update.$rename: Setting the value of [${a}] to [${JSON.stringify(i)}] failed.`),n=!1)):(e.OpLog&&e.OpLog(`Update.$rename: Unsetting the value of [${o}] failed.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$rename: ${r.message}`),r}}}}},2652:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let a=t[o];!1!==e.SetValue(r,o,a)||(e.OpLog&&Engine.OpLog(`Update.$set: Setting the value of [${o}] to [${JSON.stringify(a)}] failed.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$set: ${r.message}`),r}}}}},7101:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t)!1!==e.SetValue(r,o,void 0)||(Engine.OpLog&&Engine.OpLog(`Update.$unset: Unsetting the value of [${o}] failed.`),n=!1);return n}catch(r){throw e.OpError&&e.OpError(`Update.$unset: ${r.message}`),r}}}}},8792:e=>{e.exports={Compare:function(e,r,t=!0){if("string"!=typeof e)throw new Error("The parameter [TextA] must be a string.");if("string"!=typeof r)throw new Error("The parameter [TextB] must be a string.");return t||(e=e.toLowerCase(),r=r.toLowerCase()),e.localeCompare(r)},FindBetween:function(e,r,t,n=!0){if("string"!=typeof e)throw new Error("The parameter [Text] must be a string.");if(null==r&&(r=""),"string"!=typeof r)throw new Error("The parameter [StartText] must be a string or null.");if(null==t&&(t=""),"string"!=typeof t)throw new Error("The parameter [EndText] must be a string or null.");let o=e;n||(o=o.toLowerCase(),r=r.toLowerCase(),t=t.toLowerCase());let a=0;if(r.length&&(a=o.indexOf(r)),a<0)return null;let i=o.length;return t.length&&(i=o.indexOf(t,a+r.length)),i<0?null:e.substring(a+r.length,i)},Matches:function(e,r,t=!0){let n=r.replace(/[.+^${}()|[\]\\]/g,"\\$&"),o="";return t||(o+="i"),new RegExp(`^${n.replace(/\*/g,".*").replace(/\?/g,".")}$`,o).test(e)}}},986:(e,r,t)=>{e.exports=function e(r={}){void 0===r.OpLog&&(r.OpLog=null),void 0===r.OpError&&(r.OpError=null);let n={};n.NewJsongin=e;let o=t(4147);return n.Library={name:o.name,url:o.homepage,version:o.version},n.Settings=r,n.QueryOperators={$eq:t(3374)(n),$ne:t(3490)(n),$gt:t(5132)(n),$gte:t(7588)(n),$lt:t(2207)(n),$lte:t(424)(n),$in:t(4038)(n),$nin:t(7879)(n),$and:t(3209)(n),$or:t(7577)(n),$nor:t(5809)(n),$not:t(1008)(n),$regex:t(6940)(n),$elemMatch:t(3999)(n),$size:t(4950)(n),$all:t(2863)(n),$exists:t(5611)(n),$type:t(6475)(n),$ImplicitEq:t(8469)(n),$eqx:t(2239)(n),$nex:t(4105)(n),$query:t(8250)(n),$noop:t(3565)(n)},n.UpdateOperators={$set:t(2652)(n),$unset:t(7101)(n),$rename:t(6818)(n),$inc:t(7095)(n),$min:t(7863)(n),$max:t(4178)(n),$mul:t(4581)(n),$currentDate:t(5730)(n),$addToSet:t(5778)(n),$pop:t(7585)(n),$push:t(6396)(n),$pullAll:t(9164)(n)},n.Text=t(8792),n.Query=t(2250)(n),n.Project=t(1896)(n),n.Update=t(4609)(n),n.Filter=t(1844)(n),n.Sort=t(4066)(n),n.Distinct=t(214)(n),n.Parse=t(4074)(n),n.Format=t(1330)(n),n.SplitPath=t(5415)(n),n.JoinPaths=t(2345)(n),n.GetValue=t(8231)(n),n.SetValue=t(8396)(n),n.Flatten=t(5087)(n),n.Expand=t(3903)(n),n.Hybridize=t(8824)(n),n.Unhybridize=t(7159)(n),n.LooseEquals=function(e,r){return n.QueryOperators.$eqx.Query(e,r)},n.StrictEquals=function(e,r){return n.QueryOperators.$eq.Query(e,r)},n.Clone=function(e){return JSON.parse(JSON.stringify(e))},n.SafeClone=t(4978)(n),n.ShortType=t(5020)(n),n.BsonType=t(4255)(n),n.OpLog=r.OpLog,n.OpError=r.OpError,n.AsNumber=function(e){try{if(!e)return null;let r=Number(e);return isNaN(r)?null:r}catch(e){return null}},n.AsDate=function(e){try{if(!e)return null;let r=new Date(e);return isNaN(r)?null:r}catch(e){return null}},n.IsQuery=function(e){if("o"!==n.ShortType(e))return!1;for(let r in e)if(void 0!==n.QueryOperators[r])return!0;return!1},n}()},4255:e=>{e.exports=function(e){return function(e,r=!1){let t=this.ShortType(e);if("b"===t)return r?"bool":8;if("n"===t)return e.toString().includes(".")?r?"double":1:Number.isSafeInteger(e)?r?"int":16:r?"long":18;if("s"===t)return r?"string":2;if("l"===t)return r?"null":10;if("o"===t)return r?"object":3;if("a"===t)return r?"array":4;if("r"===t)return r?"regex":11;if("f"===t);else{if("y"===t)return r?"symbol":14;if("u"===t)return r?"undefined":6}return null}}},214:e=>{e.exports=function(e){return function(r,t){try{if("a"!==e.ShortType(r))throw new Error("Documents must be an array.");if("o"!==e.ShortType(t))throw new Error("DistinctCriteria must be an object.");let n={};for(let o=0;o<r.length;o++){let a=r[o],i="",u={};for(let r in t){let t=e.GetValue(a,r);e.SetValue(u,r,t),i+=JSON.stringify(t)}n[i]=u}return Object.values(n)}catch(r){throw e.OpError&&e.OpError("Sort: "+r.message),r}}}},3903:e=>{e.exports=function(e){return function(r){try{if("o"!==e.ShortType(r))throw new Error("Document must be an object.");let t={};for(let n in r)e.SetValue(t,n,r[n]);return t}catch(r){throw e.OpError&&e.OpError("Expand: "+r.message),r}}}},1844:e=>{e.exports=function(e){return function(r,t){try{if("a"!==e.ShortType(r))throw new Error("Documents must be an array.");if("o"!==e.ShortType(t))throw new Error("QueryCriteria must be an object.");let n=[];for(let o=0;o<r.length;o++)e.Query(r[o],t)&&n.push(r[o]);return n}catch(r){throw e.OpError&&e.OpError("Filter: "+r.message),r}}}},5087:e=>{e.exports=function(e){return function(r){try{let t={};function n(r,o){let a=e.ShortType(r);if("o"===a)for(let e in r){let t=o;t?t+="."+e:t=e,n(r[e],t)}else if("a"===a)for(let e=0;e<r.length;e++){let t=o;t?t+="."+e:t=""+e,n(r[e],t)}else t[o]=r}if(!"oa".includes(e.ShortType(r)))throw new Error("Document must be an object or array.");return n(r,""),t}catch(o){throw e.OpError&&e.OpError("Flatten: "+o.message),o}}}},1330:(e,r,t)=>{t(986),e.exports=function(e){function r(e,t,n,o=null){let a="";if(void 0===e);else if("boolean"==typeof e)a+=e.toString();else if("number"==typeof e)a+=e.toString();else if("bigint"==typeof e)a+=e.toString();else if("string"==typeof e){let r=e.toString();n.literal_quote&&(r=r.replace(n.literal_quote,"\\"+n.literal_quote)),a+=`${n.literal_quote}${r}${n.literal_quote}`}else if("symbol"==typeof e);else if("function"==typeof e);else if("object"==typeof e)if(null===e)a+="null";else if(Array.isArray(e)){n.braces_on_own_line&&(a+=n.eol_char,a+=n.tab_char.repeat(t)),n.eol_char?a+="["+n.eol_char:a+="["+n.space_char;for(let o=0;o<e.length;o++)a+=n.tab_char.repeat(t+1),a+=r(e[o],t+1,n,"array-element"),o<e.length-1||n.liberal_commas?n.eol_char?a+=","+n.eol_char:a+=","+n.space_char:n.eol_char&&(a+=n.eol_char);a+=n.tab_char.repeat(t),n.eol_char||(a+=n.space_char),a+="]"}else{t>0&&n.braces_on_own_line&&(a+=n.eol_char,a+=n.tab_char.repeat(t)),n.eol_char?a+="{"+n.eol_char:a+="{"+n.space_char;let o=Object.keys(e),i=0;o.map((e=>{e.length>i&&(i=e.length)}));for(let u=0;u<o.length;u++){let p=o[u];a+=n.tab_char.repeat(t+1),n.always_quote_identifiers?a+=`${n.identifier_quote}${p}${n.identifier_quote}`:a+=p,a+=":",n.align_values&&(a+=" ".repeat(i-p.length)),a+=n.space_char,a+=r(e[p],t+1,n,"field-value"),u<o.length-1||n.liberal_commas?n.eol_char?a+=","+n.eol_char:a+=","+n.space_char:n.eol_char&&(a+=n.eol_char)}a+=n.tab_char.repeat(t),n.eol_char||(a+=n.space_char),a+="}"}return a}return function(t,n=!1,o=!1){try{let e={identifier_quote:'"',always_quote_identifiers:!0,literal_quote:'"',eol_char:"",tab_char:"",space_char:""};return n&&(e.eol_char="\n",e.tab_char="    ",e.space_char=" ",o&&(e.always_quote_identifiers=!1,e.liberal_commas=!0,e.align_values=!0,e.braces_on_own_line=!0)),r(t,0,e)}catch(r){throw e.OpError&&e.OpError("Format: "+r.message),r}}}},8231:(e,r,t)=>{t(986),e.exports=function(e){return function r(t,n){try{switch(e.ShortType(n)){case"u":case"l":return t;case"n":case"s":break;default:throw new Error(`Path is invalid [${JSON.stringify(n)}].`)}if(0===n.length)return t;let o=e.SplitPath(n),a=t;for(let t=0;t<o.length;t++){let n=o[t],i=e.ShortType(n),u=e.ShortType(a);if("a"===u){if("n"===i){if(n<0&&(n=a.length+n),n<0)return;if(n>=a.length)return;a=a[n];continue}{let e=[],n=o.slice(t).join(".");for(let t=0;t<a.length;t++){let o=r(a[t],n);e.push(o)}return e}}if("o"!==u)return;a=a[n]}return a}catch(r){throw e.OpError&&e.OpError("GetValue: "+r.message),r}}}},8824:e=>{e.exports=function(e){return function(r){let t={};for(let n in r)switch(e.ShortType(r[n])){case"b":case"n":case"s":case"l":t[n]=r[n];break;case"o":t[n]=JSON.stringify({type:"o",value:r[n]});break;case"a":t[n]=JSON.stringify({type:"a",value:r[n]});break;case"r":t[n]=JSON.stringify({type:"r",flags:r[n].flags,source:r[n].source});break;case"e":t[n]=JSON.stringify({type:"e",message:r[n].message});break;case"f":t[n]=JSON.stringify({type:"f",source:r[n].toString()});break;case"y":t[n]=JSON.stringify({type:"y",source:r[n].toString()});break;case"u":t[n]=JSON.stringify({type:"u"})}return t}}},2345:e=>{e.exports=function(e){return function(){try{let r=[];for(let t=0;t<arguments.length;t++){let n=arguments[t];switch(e.ShortType(n)){case"u":case"l":continue;case"n":n=[""+n];break;case"s":case"a":break;default:throw new Error(`Path segment is invalid [${JSON.stringify(n)}].`)}"string"==typeof n&&(n=e.SplitPath(n));let o=[];for(let r=0;r<n.length;r++){let t=e.SplitPath(n[r]);o.push(...t)}r.push(...o)}return r.join(".")}catch(r){throw e.OpError&&e.OpError("JoinPaths: "+r.message),r}}}},4074:(e,r,t)=>{t(986),e.exports=function(e){function r(e){for(;e.length;){if("["===e[0].token){e.shift();let n=[];for(;"]"!==e[0].token;)n.push(r(e));return e.shift(),t(e),n}if("{"===e[0].token){e.shift();let n={};for(;"}"!==e[0].token;){let t=e.shift(),o=e.shift();if("literal"!==t.type&&"string"!==t.type)throw new Error(`At position [${t.at}]: Expected literal, found ${t.type} '${t.token}' instead.`,t);if(":"!==o.token)throw new Error(`At position [${o.at}]: Expected ':', found '${o.token}' instead.`,o);n[t.token]=r(e)}return e.shift(),t(e),n}{let r=e[0].token;return"literal"===e[0].type&&("null"===r.toLowerCase()?r=null:"true"===r.toLowerCase()?r=!0:"false"===r.toLowerCase()&&(r=!1),!isNaN(parseFloat(r))&&isFinite(r)&&(r=parseFloat(r))),e.shift(),t(e),r}}}function t(e){e.length&&","===e[0].token&&e.shift()}return function(t){try{let e=function(e){let r=[],t=" \t\r\n",n="[]{}:,",o=0;for(;o<e.length;){let a=e.charAt(o);if(t.includes(a))o++;else if(n.includes(a))r.push({token:a,type:"delimiter",at:o}),o++;else if("'\"".includes(a)){let t=o;o++;let n="";for(;o<e.length;){let r=e.charAt(o);if(r===a){o++;break}"\\"===r&&(o++,r=o<e.length?e.charAt(o):""),n+=r,o++}r.push({token:n,type:"string",at:t})}else{let i=o;o++;let u=a;for(;o<e.length;){let r=e.charAt(o);if(t.includes(r)||n.includes(r)||"'\"".includes(r))break;u+=r,o++}r.push({token:u,type:"literal",at:i})}}return r}(t);return r(e)}catch(r){throw e.OpError&&e.OpError("Parse: "+r.message),r}}}},1896:e=>{e.exports=function(e){return function(r,t){if("o"!==e.ShortType(r))return e.OpLog&&e.OpLog("Projection: The Document parameter must be an object."),null;r=e.Clone(r);let n=e.ShortType(t);if(!0==="lu".includes(n))return r;if("o"!==n)return e.OpLog&&e.OpLog("Projection: The Projection parameter must be an object."),null;t=e.Clone(t);let o="",a=!0;for(let r in t){let n=t[r];if("_id"===r)0===n&&(a=!1),delete t[r];else if(1===n){if("exclude"===o)return e.OpLog&&e.OpLog("Update: Cannot combine inclusion and exclusion operators in the same update."),null;o="include"}else if(0===n){if("include"===o)return e.OpLog&&e.OpLog("Update: Cannot combine inclusion and exclusion operators in the same update."),null;o="exclude"}}""===o&&(o=a?"include":"exclude");let i=null;if("exclude"===o){i=e.Clone(r);for(let r in t)!1!==e.SetValue(i,r,void 0)||e.OpLog&&e.OpLog(`Projection: Failed to unset the field [${field}] in the projection.`)}else if("include"===o){i={_id:r._id};for(let n in t){let t=e.GetValue(r,n);!1!==e.SetValue(i,n,t)||e.OpLog&&e.OpLog(`Projection: Failed to set the field [${field}] in the projection.`)}}return!1===a&&delete i._id,i}}},2250:e=>{e.exports=function(e){function r(r){if("o"!==e.ShortType(r))return!1;for(let t in r)if(void 0!==e.QueryOperators[t])return!0;return!1}return function(t,n,o=""){if("o"!==e.ShortType(t))return e.OpLog&&e.OpLog("Query: The Document parameter must be an object."),!1;if("o"!==e.ShortType(n))return e.OpLog&&e.OpLog("Query: The Criteria parameter must be an object."),!1;{let r=e.SplitPath(o);o=null===r?"":r.join(".")}if(""===o&&0===Object.keys(n).length)return e.OpLog&&e.OpLog("Query: An empty query object {} matches everything."),!0;for(let a in n)if(void 0!==e.QueryOperators[a]){if(""===o&&!e.QueryOperators[a].TopLevel)return e.OpLog&&e.OpLog(`Query: Operator [${a}] cannot appear at the top level of a query. Only logical operators can appear at the top level of a query.`),!1;let r=n[a];if(void 0===r)return e.OpLog&&e.OpLog(`Query: Operator [${a}] cannot be set to undefined. Use $exists to test if a field exists in the document.`),!1;if(!1===e.QueryOperators[a].Query(t,r,o))return e.OpLog&&e.OpLog(`Query: Operator [${a}] returned false at [${o}].`),!1}else{let i=n[a],u=e.JoinPaths(o,a),p=!1;if(r(i))p=e.Query(t,i,u);else{if(void 0===i)return e.OpLog&&e.OpLog("Query: The implicit $eq operator cannot be set to undefined. Use $exists to test if a field exists in the document."),!1;p=e.QueryOperators.$ImplicitEq.Query(t,i,u)}if(!1===p)return!1}return!0}}},4978:e=>{e.exports=function(e){return function(r,t){try{switch(e.ShortType(t)){case"l":case"u":t=[];break;case"s":t=[t];break;case"a":break;default:throw new Error("The Exceptions parameter must be a document path or array of paths in dot notation.")}function n(r,o){let a=e.ShortType(r);switch(a){case"b":case"n":case"s":case"l":case"r":case"e":case"f":case"y":case"u":return r;case"o":{let e={};for(let a in r){let i=o;i?i+="."+a:i=a,t.includes(i)?e[a]=r[a]:e[a]=n(r[a],i)}return e}case"a":{let e=[];for(let a=0;a<r.length;a++){let i=o;i?i+="."+a:i=""+a,t.includes(i)?e.push(r[a]):e.push(n(r[a],i))}return e}default:throw new Error(`Unrecognized short type [${a}] at [${o}].`)}}return n(r,"")}catch(o){throw e.OpError&&e.OpError("SafeClone: "+o.message),o}}}},8396:e=>{e.exports=function(e){return function r(t,n,o){try{switch(e.ShortType(t)){case"o":case"a":break;default:throw new Error("Document must be an object or array.")}switch(e.ShortType(n)){case"u":case"l":n="";break;case"n":case"s":break;default:throw new Error(`Path is invalid [${JSON.stringify(n)}].`)}if(0===n.length)return e.OpLog&&e.OpLog("SetValue: Path is empty."),!1;let a=e.SplitPath(n),i=t;for(let t=0;t<a.length;t++){let u=a[t],p=e.ShortType(u),l=e.ShortType(i);if("a"===l){if("n"===p){if(u<0&&(u=i.length+u),u<0)return e.OpLog&&e.OpLog(`SetValue: Disallowed negative array index [${u}] in path [${n}].`),!1;if(t===a.length-1)return i[u]=o,!0;if(void 0===i[u]){let r=e.ShortType(a[t+1]);i[u]="n"===r?[]:{}}i=i[u];continue}{let e=a.slice(t).join(".");for(let t=0;t<i.length;t++)if(!1===r(i[t],e,o))return!1;return!0}}if("o"!==l)throw new Error(`The element [${u}] of the path [${n}] must reference an object or array.`);if(t===a.length-1)return i[u]=o,!0;if(void 0!==i[u])i=i[u];else{let r=e.ShortType(a[t+1]);i[u]="n"===r?[]:{},i=i[u]}}return!0}catch(r){throw e.OpError&&e.OpError("SetValue: "+r.message),r}}}},5020:e=>{e.exports=function(e){return function(e){let r=typeof e;if("boolean"===r)return"b";if("number"===r)return"n";if("string"===r)return"s";if("object"===r)return null===e?"l":Array.isArray(e)?"a":e instanceof RegExp?"r":e instanceof Error?"e":"o";if("function"===r)return"f";if("symbol"===r)return"y";if("undefined"===r)return"u";throw new Error(`Unsupported data type [${r}].`)}}},4066:e=>{e.exports=function(e){return function(r,t){try{if("a"!==e.ShortType(r))throw new Error("Documents must be an array.");if("o"!==e.ShortType(t))throw new Error("SortCriteria must be an object.");return r.sort((function(r,n){for(let o in t){let a=t[o];if(0===a)continue;let i=a>0,u=e.GetValue(r,o),p=e.GetValue(n,o);if(u>p)return i?1:-1;if(u<p)return i?-1:1}return 0})),r}catch(r){throw e.OpError&&e.OpError("Sort: "+r.message),r}}}},5415:e=>{e.exports=function(e){return function(r){try{switch(e.ShortType(r)){case"u":case"l":return[];case"n":r=""+r;break;case"s":break;default:throw new Error(`Path is invalid [${JSON.stringify(r)}].`)}if(0===r.length)return[];let t=r.split(".");for(let r=0;r<t.length;r++){let n=t[r];null!==e.AsNumber(n)&&(n=Number(n)),t[r]=n}return t}catch(r){throw e.OpError&&e.OpError("SplitPath: "+r.message),r}}}},7159:e=>{e.exports=function(e){return function(r){let t={};for(let n in r)switch(e.ShortType(r[n])){case"b":case"n":case"l":t[n]=r[n];break;case"s":try{let e=JSON.parse(r[n]);switch(e.type){case"o":case"a":t[n]=e.value;break;case"r":t[n]=new RegExp(e.source,e.flags);break;case"e":t[n]=new Error(r[n].message);break;case"f":t[n]=new Function(r[n].source);break;case"y":t[n]=Symbol(r[n].source);break;case"u":t[n]=void 0}break}catch(e){}t[n]=r[n]}return t}}},4609:e=>{e.exports=function(e){return function(r,t){if("o"!==e.ShortType(r))return e.OpLog&&e.OpLog("Update: The Document parameter must be an object."),null;r=e.Clone(r);let n=e.ShortType(t);if(!0==="lu".includes(n))return r;if("o"!==n)return e.OpLog&&e.OpLog("Update: The Update parameter must be an object."),null;for(let n in t)void 0!==e.UpdateOperators[n]?!1===e.UpdateOperators[n].Update(r,t[n])&&e.OpLog&&e.OpLog(`Update: The update operator [${n}] failed.`):e.OpLog&&e.OpLog(`Update: Unknown update operator [${n}] encountered.`);return r}}},4147:e=>{e.exports=JSON.parse('{"name":"@liquicode/jsongin","version":"0.0.19","description":"A JSON Engine for MongoDB-Style Queries and Data Structure Manipulation","license":"MIT","homepage":"http://jsongin.liquicode.com","repository":{"type":"git","url":"https://github.com/liquicode/jsongin"},"authors":[{"name":"Andre\' G. Bowlin","email":"agbowlin@gmail.com","homepage":"http://liquicode.com"}],"main":"src/jsongin.js","scripts":{"test":"mocha -u bdd tests/*.js --timeout 0 --slow 10 --colors","publish version":"npx @liquicode/devops --tasks .\\\\build\\\\prod\\\\devops.tasks.js publish_version","start new version":"npx @liquicode/devops --tasks .\\\\build\\\\prod\\\\devops.tasks.js start_new_version"},"keywords":["mongo","mongodb","query","qbe","$eq","$and","object","compare"],"devDependencies":{"@liquicode/lib-json":"^0.1.5","@seald-io/nedb":"^4.0.2","babel-polyfill":"6.x","json-criteria":"2.x","mocha":"^10.2.0","mongodb":"4.x","nedb":"^1.8.0","webpack":"^5.89.0","webpack-cli":"^5.1.4","webpack-node-externals":"^3.0.0"},"dependencies":{}}')}},r={};return function t(n){var o=r[n];if(void 0!==o)return o.exports;var a=r[n]={exports:{}};return e[n](a,a.exports,t),a.exports}(986)})()));