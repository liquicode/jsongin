!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.jsongin=n():e.jsongin=n()}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var e={346:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"o",Query:function(e,n,t=""){let r=this.Engine.GetValue(e,t),i=this.Engine.ShortType(r);if("a"!==i&&(r=[r]),"a"!==i)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$all: document requires an array but found type [${i}] instead at [${t}].`),!1;let o=this.Engine.ShortType(n);if("a"!==o)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$all: match requires an array but found type [${o}] instead at [${t}].`),!1;for(let i=0;i<n.length;i++){let u=!1,l=this.Engine.ShortType(n[i]);if("bnsl".includes(l)?u=r.includes(n[i]):"o"===l?u=this.Engine.Query(e,n[i],t):this.Engine.Settings.Explain&&this.Engine.Explain.push(`$all: sub-match requires "bnslo" but found type [${o}] instead at [${t}].`),!1===u)return!1}return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},415:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"o",Query:function(e,n,t=""){let r=this.Engine.GetValue(e,t),i=this.Engine.ShortType(r);if("a"!==i)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$elemMatch: document requires an array but found type [${i}] instead at [${t}].`),!1;let o=this.Engine.ShortType(n);if("o"!==o)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$elemMatch: match requires an object but found type [${o}] instead at [${t}].`),!1;for(let i=0;i<r.length;i++){let r=this.Engine.JoinPaths(t,i);if(!0===this.Engine.Query(e,n,r))return!0}return!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},325:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"n",Query:function(e,n,t=""){let r=this.Engine.GetValue(e,t),i=this.Engine.ShortType(r);if("a"!==i)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$size: requires an array but found type [${i}] instead at [${t}].`),!1;let o=this.Engine.ShortType(n);return"n"!==o?(this.Engine.Settings.Explain&&this.Engine.Explain.push(`$size: requires a number but found type [${o}] instead at [${t}].`),!1):r.length===n},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},954:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(e,n,t=""){let r=this.Engine.GetValue(e,t),i=this.Engine.ShortType(r),o=n,u=this.Engine.ShortType(o),l=this.Engine.IsQuery(o),s=!1;if("bnslu".includes(i)&&"bnslu".includes(u))return s=this.Engine.Operators.$eq.Query(e,o,t),s;if("bnslu".includes(i)&&"a".includes(u))return this.Engine.Settings.Explain&&this.Engine.Explain.push(`ImplicitEq: cannot compare [${u}] type with [${i}] type at [${t}].`),!1;if("bnslu".includes(i)&&"o".includes(u))return l?(s=this.Engine.Query(e,o,t),s):(this.Engine.Settings.Explain&&this.Engine.Explain.push(`ImplicitEq: requires query when comparing against [${i}] type with [${i}] type at [${t}].`),!1);if("a".includes(i)&&"bnslu".includes(u))return s=r.includes(o),s;if("a".includes(i)&&"o".includes(u)){for(let n=0;n<r.length;n++){let r=this.Engine.JoinPaths(t,n);if(s=l?this.Engine.Query(e,o,r):this.Engine.Operators.$eq.Query(e,o,r),!0===s)return!0}return!1}if("a".includes(i)&&"a".includes(u))return s=this.Engine.Operators.$eq.Query(e,o,t),s;if("a".includes(i)&&"r".includes(u)){for(let n=0;n<r.length;n++){let r=this.Engine.JoinPaths(t,n);if(s=this.Engine.Operators.$regex.Query(e,o,r),!1===s)return!1}return!0}return"o".includes(i)&&"o".includes(u)?l?(s=this.Engine.Query(e,o,t),s):(s=this.Engine.Operators.$eq.Query(e,o,t),s):"s".includes(i)&&"r".includes(u)?(s=this.Engine.Operators.$regex.Query(e,o,t),s):(this.Engine.Settings.Explain&&this.Engine.Explain.push(`ImplicitEq: cannot compare [${u}] type with [${i}] type at [${t}].`),!1)},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},667:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(e,n,t=""){let r=this.Engine.GetValue(e,t),i=this.Engine.ShortType(r),o=n,u=this.Engine.ShortType(o);if("bnslru".includes(u)&&u===i)return r===o;if("lu".includes(u)&&"lu".includes(i))return!0;if("o"===u&&"o"===i)return!0==(JSON.stringify(o)===JSON.stringify(r));if("a"===u&&"a"===i){let e=JSON.stringify(o),n=e===JSON.stringify(r);if(!0===n)return!0;for(let t=0;t<r.length&&(n=e===JSON.stringify(r[t]),!0!==n);t++);return!0===n}return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$eq: cannot compare [${u}] type with [${i}] type at [${t}].`),!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},195:e=>{e.exports=e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(e,n,t=""){let r=this.Engine.GetValue(e,t),i=this.Engine.ShortType(r),o=n,u=this.Engine.ShortType(o);if("bns".includes(u)&&"bns".includes(i))return r==o;if("lu".includes(u)&&"lu".includes(i))return!0;if("bnslu".includes(u)||"bnslu".includes(i))return!1;if("o"===u&&"o"===i){let e=Object.keys(o),n=Object.keys(r);if(e.length!==n.length)return!1;for(let n=0;n<e.length;n++){let t=e[n];if(!1==(o[t]==r[t]))return!1}return!0}if("a"===u&&"a"===i){if(o.length!==r.length)return!1;let e=[...r];for(let n=0;n<o.length;n++){let t=!1;for(let r=0;r<e.length;r++)if(o[n]==e[r]){t=!0,e.splice(r,1);break}if(!1===t)return!1}return!0}return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$eqx: cannot compare [${u}] type with [${value_type}] type at [${t}].`),!1},ToMongoQuery:function(e){throw new Error("ToMongoQuery() is not implemented.")},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},881:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bns",Query:function(e,n,t=""){let r=this.Engine.GetValue(e,t),i=this.Engine.ShortType(r),o=n,u=this.Engine.ShortType(o);if("bns".includes(u)&&u===i)return r>o;if("a".includes(i)){let e=!1;for(let n=0;n<r.length;n++)if(e=r[n]>o,!0===e)return!0;return!1}return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$gt: cannot compare [${u}] type with [${i}] type at [${t}].`),!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},327:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnslu",Query:function(e,n,t=""){let r=this.Engine.GetValue(e,t),i=this.Engine.ShortType(r),o=n,u=this.Engine.ShortType(o);if("bns".includes(u)&&u===i)return r>=o;if("lu".includes(u)&&"lu".includes(i))return!0;if("a".includes(i)){let e=!1;for(let n=0;n<r.length;n++)if(e=r[n]>=o,!0===e)return!0;return!1}return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$gte: cannot compare [${u}] type with [${i}] type at [${t}].`),!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},773:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"a",Query:function(e,n,t=""){let r=this.Engine.GetValue(e,t),i=this.Engine.ShortType(r),o=n,u=this.Engine.ShortType(o);if("a"!==u)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$in: expected an array but found a type [${u}] instead at [${t}].`),!1;function l(e,n,t){if("r"===e.ShortType(t)){for(let e=0;e<n.length;e++)if(t.test(n[e]))return!0}else if(n.includes(t))return!0;return!1}if("a"===i){for(let e=0;e<o.length;e++)if(l(this.Engine,r,o[e]))return!0}else if("bnslou".includes(i)&&l(this.Engine,o,r))return!0;return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$in: cannot compare [${u}] type with [${i}] type at [${t}].`),!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},212:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bns",Query:function(e,n,t=""){let r=this.Engine.GetValue(e,t),i=this.Engine.ShortType(r),o=n,u=this.Engine.ShortType(o);if("bns".includes(u)&&u===i)return r<o;if("a".includes(i)){let e=!1;for(let n=0;n<r.length;n++)if(e=r[n]<o,!0===e)return!0;return!1}return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$lt: cannot compare [${u}] type with [${i}] type at [${t}].`),!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},857:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnslu",Query:function(n,t,r=""){let i=e.GetValue(n,r),o=e.ShortType(i),u=t,l=e.ShortType(u);if("bns".includes(l)&&l===o)return i<=u;if("lu".includes(l)&&"lu".includes(o))return!0;if("a".includes(o)){let e=!1;for(let n=0;n<i.length;n++)if(e=i[n]<=u,!0===e)return!0;return!1}return e.Settings.Explain&&e.Explain.push(`$lte: cannot compare [${l}] type with [${o}] type at [${r}].`),!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},645:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloau",Query:function(e,n,t=""){return!this.Engine.Operators.$eq.Query(e,n,t)},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},765:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloau",Query:function(e,n,t=""){return!this.Engine.Operators.$eqx.Query(e,n,t)},ToMongoQuery:function(e){throw new Error("ToMongoQuery() is not implemented.")},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},694:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"a",Query:function(e,n,t=""){return!this.Engine.Operators.$in.Query(e,n,t)},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},12:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"sr",Query:function(e,n,t=""){let r=this.Engine.GetValue(e,t),i=(this.Engine.ShortType(r),n),o=this.Engine.ShortType(i);return"sr".includes(o)?("s"===o&&(i=new RegExp(i)),i.test(r)):(this.Engine.Settings.Explain&&this.Engine.Explain.push(`$regex: requires regexp or string but found [${o}] instead at [${t}].`),!1)},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},725:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(e,n,t){let r=this.Engine.ShortType(n);if("a"!==r)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$and: requires an array but found type [${r}] instead at [${t}].`),!1;for(let r=0;r<n.length;r++)if(!1===this.Engine.Query(e,n[r],t))return!1;return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},382:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(e,n,t=""){let r=this.Engine.ShortType(n);if("a"!==r)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$nor: requires an array but found type [${r}] instead at [${t}].`),!1;for(let r=0;r<n.length;r++)if(!0===this.Engine.Query(e,n[r],t))return!1;return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},492:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"or",Query:function(e,n,t=""){let r=n,i=this.Engine.ShortType(r),o=!1;return"o"===i?o=this.Engine.Query(e,r,t):"r"===i?o=this.Engine.Operators.$regex.Query(e,r,t):this.Engine.Settings.Explain&&this.Engine.Explain.push(`$not: requires an object or regexp but found type [${i}] instead at [${t}].`),!o},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},105:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(e,n,t=""){let r=this.Engine.ShortType(n);if("a"!==r)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$or: requires an array but found type [${r}] instead at [${t}].`),!1;for(let r=0;r<n.length;r++)if(!0===this.Engine.Query(e,n[r],t))return!0;return!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},78:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(e,n,t=""){let r=this.Engine.GetValue(e,t),i=this.Engine.ShortType(r),o=this.Engine.ShortType(n);if("b"!==o)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$exists: requires a boolean but found type [${o}] instead at [${t}].`),!1;if(!0===n){if("u"!==i)return!0}else if("u"===i)return!0;return!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},39:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(e,n,t=""){return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$noop: always returns true at [${t}].`),!0},ToMongoQuery:function(e){},ToSql:function(e){return""}}}},517:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(e,n,t=""){return!0},ToMongoQuery:function(e){},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},969:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"nsa",Query:function(e,n,t=""){let r=this.Engine.GetValue(e,t);"a"!==this.Engine.ShortType(r)&&(r=[r]);let i=this.Engine.ShortType(n);"a"!==i&&(n=[n]);for(let e=0;e<n.length;e++){let o=n[e];if(i=this.Engine.ShortType(o),"n"===i){for(let e=0;e<r.length;e++)if(o===this.Engine.BsonType(r[e],!1))return!0}else{if("s"!==i)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$type: requires a number or string but found type [${i}] instead at [${t}].`),!1;for(let e=0;e<r.length;e++){let n=this.Engine.BsonType(r[e],!0);if(o===n)return!0;if("number"===o&&["int","long","double","decimal"].includes(n))return!0}}}return!1},ToMongoQuery:function(e){},ToSql:function(e){return""}}}},792:e=>{e.exports={Compare:function(e,n,t=!0){if("string"!=typeof e)throw new Error("The parameter [TextA] must be a string.");if("string"!=typeof n)throw new Error("The parameter [TextB] must be a string.");return t||(e=e.toLowerCase(),n=n.toLowerCase()),e.localeCompare(n)},FindBetween:function(e,n,t,r=!0){if("string"!=typeof e)throw new Error("The parameter [Text] must be a string.");if(null==n&&(n=""),"string"!=typeof n)throw new Error("The parameter [StartText] must be a string or null.");if(null==t&&(t=""),"string"!=typeof t)throw new Error("The parameter [EndText] must be a string or null.");let i=e;r||(i=i.toLowerCase(),n=n.toLowerCase(),t=t.toLowerCase());let o=0;if(n.length&&(o=i.indexOf(n)),o<0)return null;let u=i.length;return t.length&&(u=i.indexOf(t,o+n.length)),u<0?null:e.substring(o+n.length,u)},Matches:function(e,n,t=!0){let r=n.replace(/[.+^${}()|[\]\\]/g,"\\$&"),i="";return t||(i+="i"),new RegExp(`^${r.replace(/\*/g,".*").replace(/\?/g,".")}$`,i).test(e)}}},986:(e,n,t)=>{const r=t(792);e.exports=function(e={}){void 0===e.PathExtensions&&(e.PathExtensions=!1),void 0===e.Explain&&(e.Explain=!1),void 0===e.ClearExplainOnTopLevelQuery&&(e.ClearExplainOnTopLevelQuery=!0);let n={};return n.Settings=e,n.Explain=[],n.Operators={$and:t(725)(n),$or:t(105)(n),$nor:t(382)(n),$not:t(492)(n),$ImplicitEq:t(954)(n),$eq:t(667)(n),$eqx:t(195)(n),$ne:t(645)(n),$nex:t(765)(n),$gt:t(881)(n),$gte:t(327)(n),$lt:t(212)(n),$lte:t(857)(n),$in:t(773)(n),$nin:t(694)(n),$regex:t(12)(n),$elemMatch:t(415)(n),$size:t(325)(n),$all:t(346)(n),$exists:t(78)(n),$type:t(969)(n),$query:t(517)(n),$noop:t(39)(n)},n.ShortType=function(e){let n=typeof e;if("boolean"===n)return"b";if("number"===n)return"n";if("string"===n)return"s";if("object"===n)return null===e?"l":Array.isArray(e)?"a":e instanceof RegExp?"r":"o";if("function"===n)return"f";if("symbol"===n)return"y";if("undefined"===n)return"u";throw new Error(`Unsupported field type [${n}].`)},n.BsonType=function(e,n=!1){let t=this.ShortType(e);if("b"===t)return n?"bool":8;if("n"===t)return e.toString().includes(".")?n?"double":1:Number.isSafeInteger(e)?n?"int":16:n?"long":18;if("s"===t)return n?"string":2;if("l"===t)return n?"null":10;if("o"===t)return n?"object":3;if("a"===t)return n?"array":4;if("r"===t)return n?"regex":11;if("f"===t);else{if("y"===t)return n?"symbol":14;if("u"===t)return n?"undefined":6}return null},n.SplitPath=function(e){if("string"!=typeof e)return n.Settings.Explain&&n.Explain.push(`SplitPath: Path is invalid [${QueryPath}].`),null;if(""===e)return[];let t=e.split("."),i=0;for(;i<t.length;){let o=t[i];if(""===o)return n.Settings.Explain&&n.Explain.push(`SplitPath: Path cannot contain empty elements in [${e}].`),null;if("$"===o){if(0===i){if(!n.Settings.PathExtensions)return n.Settings.Explain&&n.Explain.push(`SplitPath: Path cannot start with the $ root element without path extensions in [${e}].`),null;t.splice(0,1);continue}return n.Settings.Explain&&n.Explain.push(`SplitPath: Cannot contain the $ element within path [${e}].`),null}let u=r.FindBetween(o,"[","]");if(n.Settings.PathExtensions&&u){if(isNaN(Number(u)))return n.Settings.Explain&&n.Explain.push(`SplitPath: A non-numeric array index [${u}] was found in [${e}].`),null;if(u=Number(u),o=r.FindBetween(o,null,"["),o&&o.length){if("$"===o){if(0!==i)return n.Settings.Explain&&n.Explain.push(`SplitPath: Cannot contain the $ element within path [${e}].`),null;if(!n.Settings.PathExtensions)return n.Settings.Explain&&n.Explain.push(`SplitPath: Path cannot start with the $ root element without path extensions in [${e}].`),null;t.splice(0,1)}else t[i]=o,i++;t.splice(i,0,u)}else t[i]=u}else isNaN(Number(o))||(t[i]=Number(o));i++}return t},n.JoinPaths=function(){let e=[];for(let t=0;t<arguments.length;t++){if(null===arguments[t])continue;let r=""+arguments[t],i=n.SplitPath(r);null!==i&&e.push(...i)}return e.join(".")},n.GetValue=function(e,t){if(void 0===t)return e;if(null===t)return e;if("string"!=typeof t)return void(n.Settings.Explain&&n.Explain.push(`GetValue: Path is invalid [${t}].`));if(0===t.length)return e;let r=n.SplitPath(t);if(null===r)return void(n.Settings.Explain&&n.Explain.push("GetValue: SplitPath returned null."));let i=e;for(let e=0;e<r.length;e++){let o=r[e];if(void 0===i[o]){if("number"==typeof o)return void(n.Settings.Explain&&n.Explain.push(`GetValue: Array index [${o}] is out of bounds at [${t}].`));if("a"!==n.ShortType(i))return;if(0===i.length)return;let u=[],l=r.slice(e).join(".");if(!1===n.PathTerminals(i,l,(function(e,n,t){u.push(e)})))return;return u}i=i[o]}return i},n.SetValue=function(e,t,r){let i=n.ShortType(e);if(!"oa".includes(i))return n.Settings.Explain&&n.Explain.push("SetValue: Document must be an object or array."),!1;let o=n.SplitPath(t);if(null===o)return n.Settings.Explain&&n.Explain.push("SetValue: SplitPath returned null."),!1;if(0===o.length)return n.Settings.Explain&&n.Explain.push("SetValue: Cannot set a value using an empty path."),!1;let u=e,l="";for(let e=0;e<o.length;e++){let t=o[e];l.length>0&&(l+="."),l+=t;let i=n.ShortType(u);if("o"===i){if("number"==typeof t)return n.Settings.Explain&&n.Explain.push(`SetValue: Type mismatch at [${l}]. Expected a field name but found an array index instead.`),!1;if(void 0===u[t]&&(u[t]={}),e===o.length-1)return void 0===r?delete u[t]:u[t]=JSON.parse(JSON.stringify(r)),!0}else if("a"===i){if("string"==typeof t)return n.Settings.Explain&&n.Explain.push(`SetValue: Type mismatch at [${l}]. Expected a array index but found a field name instead.`),!1;for(;u.length<t;)u.push(null);if(e===o.length-1)return void 0===r?u.splice(t,1):u[t]=JSON.parse(JSON.stringify(r)),!0}u=u[t]}return!0},n.PathTerminals=function(e,t,r){let i=function e(t,i,o){if(void 0===t)return!1;if(null===o)return!1;let u=t,l=n.ShortType(u),s=[...o];if("a"===l){if(s.length&&"number"==typeof s[0]){let t=s[0];s.splice(0,1);let r=n.JoinPaths(i,t);if(!e(u[t],r,s))return!1}else for(let t=0;t<u.length;t++)if(!e(u[t],n.JoinPaths(i,t),s))return!1}else if("o"===l){let t=s[0];s.splice(0,1);let o=u[t],l=n.ShortType(o),a=n.JoinPaths(i,t);if(0===s.length)if("a"===l){if(!e(o,a,s))return!1}else r(o,l,a);else if(!e(o,a,s))return!1}else{if(0!==s.length)return n.Settings.Explain&&n.Explain.push(`PathTerminals: Unresolved path elements exist: [${s.join(".")}].`),!1;r(u,l,i)}return!0}(e,"",n.SplitPath(t));return i},n.Query=function(e,t,r=""){if(""===r&&n.Settings.ClearExplainOnTopLevelQuery&&(n.Explain=["Query: Cleared explain on top level match."]),"o"!==n.ShortType(e))return n.Settings.Explain&&n.Explain.push("Query: The Document parameter must be an object."),!1;if("o"!==n.ShortType(t))return n.Settings.Explain&&n.Explain.push("Query: The Query parameter must be an object."),!1;{let e=n.SplitPath(r);r=null===e?"":e.join(".")}if(""===r&&0===Object.keys(t).length)return n.Settings.Explain&&n.Explain.push("Query: An empty query object {} matches everything."),!0;for(let i in t)if(void 0!==n.Operators[i]){if(""===r&&!n.Operators[i].TopLevel)return n.Settings.Explain&&n.Explain.push(`Query: Operator [${i}] cannot appear at the top level of a query. Only logical operators can appear at the top level of a query.`),!1;if(!1===n.Operators[i].Query(e,t[i],r))return n.Settings.Explain&&n.Explain.push(`Query: Operator [${i}] returned false at [${r}].`),!1}else{let o=t[i],u=n.JoinPaths(r,i),l=!1;if(l=n.IsQuery(o)?n.Query(e,o,u):n.Operators.$ImplicitEq.Query(e,o,u),!1===l)return!1}return!0},n.IsQuery=function(e){if("o"!==n.ShortType(e))return!1;for(let t in e)if(void 0!==n.Operators[t])return!0;return!1},n.Equals=function(e,t,r=!1){return r?n.Operators.$eq.Query(e,t):n.Operators.$eqx.Query(e,t)},n.StrictEquals=function(e,t){return n.Equals(e,t,!0)},n.Clone=function(e){return JSON.parse(JSON.stringify(e))},n}}},n={};return function t(r){var i=n[r];if(void 0!==i)return i.exports;var o=n[r]={exports:{}};return e[r](o,o.exports,t),o.exports}(986)})()));