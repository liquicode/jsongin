!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.jsongin=n():e.jsongin=n()}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var e={863:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"o",Query:function(e,n,t=""){let i=this.Engine.GetValue(e,t),r=this.Engine.ShortType(i);if("a"!==r&&(i=[i]),"a"!==r)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$all: document requires an array but found type [${r}] instead at [${t}].`),!1;let o=this.Engine.ShortType(n);if("a"!==o)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$all: match requires an array but found type [${o}] instead at [${t}].`),!1;for(let r=0;r<n.length;r++){let u=!1,l=this.Engine.ShortType(n[r]);if("bnsl".includes(l)?u=i.includes(n[r]):"o"===l?u=this.Engine.Query(e,n[r],t):this.Engine.Settings.Explain&&this.Engine.Explain.push(`$all: sub-match requires "bnslo" but found type [${o}] instead at [${t}].`),!1===u)return!1}return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},999:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"o",Query:function(e,n,t=""){let i=this.Engine.GetValue(e,t),r=this.Engine.ShortType(i);if("a"!==r)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$elemMatch: document requires an array but found type [${r}] instead at [${t}].`),!1;let o=this.Engine.ShortType(n);if("o"!==o)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$elemMatch: match requires an object but found type [${o}] instead at [${t}].`),!1;for(let r=0;r<i.length;r++){let i=this.Engine.JoinPaths(t,r);if(!0===this.Engine.Query(e,n,i))return!0}return!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},950:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"n",Query:function(e,n,t=""){let i=this.Engine.GetValue(e,t),r=this.Engine.ShortType(i);if("a"!==r)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$size: requires an array but found type [${r}] instead at [${t}].`),!1;let o=this.Engine.ShortType(n);return"n"!==o?(this.Engine.Settings.Explain&&this.Engine.Explain.push(`$size: requires a number but found type [${o}] instead at [${t}].`),!1):i.length===n},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},374:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(e,n,t=""){let i=this.Engine.GetValue(e,t),r=this.Engine.ShortType(i),o=n,u=this.Engine.ShortType(o);if("bnslru".includes(u)&&u===r)return i===o;if("lu".includes(u)&&"lu".includes(r))return!0;if("o"===u&&"o"===r)return!0==(JSON.stringify(o)===JSON.stringify(i));if("a"===u&&"a"===r){let e=JSON.stringify(o),n=e===JSON.stringify(i);if(!0===n)return!0;for(let t=0;t<i.length&&(n=e===JSON.stringify(i[t]),!0!==n);t++);return!0===n}return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$eq: cannot compare [${u}] type with [${r}] type at [${t}].`),!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},132:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bns",Query:function(e,n,t=""){let i=this.Engine.GetValue(e,t),r=this.Engine.ShortType(i),o=n,u=this.Engine.ShortType(o);if("bns".includes(u)&&u===r)return i>o;if("a".includes(r)){let e=!1;for(let n=0;n<i.length;n++)if(e=i[n]>o,!0===e)return!0;return!1}return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$gt: cannot compare [${u}] type with [${r}] type at [${t}].`),!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},588:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnslu",Query:function(e,n,t=""){let i=this.Engine.GetValue(e,t),r=this.Engine.ShortType(i),o=n,u=this.Engine.ShortType(o);if("bns".includes(u)&&u===r)return i>=o;if("lu".includes(u)&&"lu".includes(r))return!0;if("a".includes(r)){let e=!1;for(let n=0;n<i.length;n++)if(e=i[n]>=o,!0===e)return!0;return!1}return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$gte: cannot compare [${u}] type with [${r}] type at [${t}].`),!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},38:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"a",Query:function(e,n,t=""){let i=this.Engine.GetValue(e,t),r=this.Engine.ShortType(i),o=n,u=this.Engine.ShortType(o);if("a"!==u)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$in: expected an array but found a type [${u}] instead at [${t}].`),!1;function l(e,n,t){if("r"===e.ShortType(t)){for(let e=0;e<n.length;e++)if(t.test(n[e]))return!0}else if(n.includes(t))return!0;return!1}if("a"===r){for(let e=0;e<o.length;e++)if(l(this.Engine,i,o[e]))return!0}else if("bnslou".includes(r)&&l(this.Engine,o,i))return!0;return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$in: cannot compare [${u}] type with [${r}] type at [${t}].`),!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},207:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bns",Query:function(e,n,t=""){let i=this.Engine.GetValue(e,t),r=this.Engine.ShortType(i),o=n,u=this.Engine.ShortType(o);if("bns".includes(u)&&u===r)return i<o;if("a".includes(r)){let e=!1;for(let n=0;n<i.length;n++)if(e=i[n]<o,!0===e)return!0;return!1}return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$lt: cannot compare [${u}] type with [${r}] type at [${t}].`),!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},424:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnslu",Query:function(n,t,i=""){let r=e.GetValue(n,i),o=e.ShortType(r),u=t,l=e.ShortType(u);if("bns".includes(l)&&l===o)return r<=u;if("lu".includes(l)&&"lu".includes(o))return!0;if("a".includes(o)){let e=!1;for(let n=0;n<r.length;n++)if(e=r[n]<=u,!0===e)return!0;return!1}return e.Settings.Explain&&e.Explain.push(`$lte: cannot compare [${l}] type with [${o}] type at [${i}].`),!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},490:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloau",Query:function(e,n,t=""){return!this.Engine.QueryOperators.$eq.Query(e,n,t)},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},879:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"a",Query:function(e,n,t=""){return!this.Engine.QueryOperators.$in.Query(e,n,t)},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},611:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(e,n,t=""){let i=this.Engine.GetValue(e,t),r=this.Engine.ShortType(i),o=this.Engine.ShortType(n);if("b"!==o)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$exists: requires a boolean but found type [${o}] instead at [${t}].`),!1;if(!0===n){if("u"!==r)return!0}else if("u"===r)return!0;return!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},718:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(e,n,t=""){return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$noop: always returns true at [${t}].`),!0},ToMongoQuery:function(e){},ToSql:function(e){return""}}}},222:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(e,n,t=""){return!0},ToMongoQuery:function(e){},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},475:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"nsa",Query:function(e,n,t=""){let i=this.Engine.GetValue(e,t);"a"!==this.Engine.ShortType(i)&&(i=[i]);let r=this.Engine.ShortType(n);"a"!==r&&(n=[n]);for(let e=0;e<n.length;e++){let o=n[e];if(r=this.Engine.ShortType(o),"n"===r){for(let e=0;e<i.length;e++)if(o===this.Engine.BsonType(i[e],!1))return!0}else{if("s"!==r)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$type: requires a number or string but found type [${r}] instead at [${t}].`),!1;for(let e=0;e<i.length;e++){let n=this.Engine.BsonType(i[e],!0);if(o===n)return!0;if("number"===o&&["int","long","double","decimal"].includes(n))return!0}}}return!1},ToMongoQuery:function(e){},ToSql:function(e){return""}}}},940:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"sr",Query:function(e,n,t=""){let i=this.Engine.GetValue(e,t),r=(this.Engine.ShortType(i),n),o=this.Engine.ShortType(r);return"sr".includes(o)?("s"===o&&(r=new RegExp(r)),r.test(i)):(this.Engine.Settings.Explain&&this.Engine.Explain.push(`$regex: requires regexp or string but found [${o}] instead at [${t}].`),!1)},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},469:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(e,n,t=""){let i=this.Engine.GetValue(e,t),r=this.Engine.ShortType(i),o=n,u=this.Engine.ShortType(o),l=this.Engine.IsQuery(o),a=!1;if("bnslu".includes(r)&&"bnslu".includes(u))return a=this.Engine.QueryOperators.$eq.Query(e,o,t),a;if("bnslu".includes(r)&&"a".includes(u))return this.Engine.Settings.Explain&&this.Engine.Explain.push(`ImplicitEq: cannot compare [${u}] type with [${r}] type at [${t}].`),!1;if("bnslu".includes(r)&&"o".includes(u))return l?(a=this.Engine.Query(e,o,t),a):(this.Engine.Settings.Explain&&this.Engine.Explain.push(`ImplicitEq: requires query when comparing against [${r}] type with [${r}] type at [${t}].`),!1);if("a".includes(r)&&"bnslu".includes(u))return a=i.includes(o),a;if("a".includes(r)&&"o".includes(u)){for(let n=0;n<i.length;n++){let i=this.Engine.JoinPaths(t,n);if(a=l?this.Engine.Query(e,o,i):this.Engine.QueryOperators.$eq.Query(e,o,i),!0===a)return!0}return!1}if("a".includes(r)&&"a".includes(u))return a=this.Engine.QueryOperators.$eq.Query(e,o,t),a;if("a".includes(r)&&"r".includes(u)){for(let n=0;n<i.length;n++){let i=this.Engine.JoinPaths(t,n);if(a=this.Engine.QueryOperators.$regex.Query(e,o,i),!1===a)return!1}return!0}return"o".includes(r)&&"o".includes(u)?l?(a=this.Engine.Query(e,o,t),a):(a=this.Engine.QueryOperators.$eq.Query(e,o,t),a):"s".includes(r)&&"r".includes(u)?(a=this.Engine.QueryOperators.$regex.Query(e,o,t),a):(this.Engine.Settings.Explain&&this.Engine.Explain.push(`ImplicitEq: cannot compare [${u}] type with [${r}] type at [${t}].`),!1)},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},239:e=>{e.exports=e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(e,n,t=""){let i=this.Engine.GetValue(e,t),r=this.Engine.ShortType(i),o=n,u=this.Engine.ShortType(o);if("bns".includes(u)&&"bns".includes(r))return i==o;if("lu".includes(u)&&"lu".includes(r))return!0;if("bnslu".includes(u)||"bnslu".includes(r))return!1;if("o"===u&&"o"===r){let e=Object.keys(o),n=Object.keys(i);if(e.length!==n.length)return!1;for(let n=0;n<e.length;n++){let t=e[n];if(!1==(o[t]==i[t]))return!1}return!0}if("a"===u&&"a"===r){if(o.length!==i.length)return!1;let e=[...i];for(let n=0;n<o.length;n++){let t=!1;for(let i=0;i<e.length;i++)if(o[n]==e[i]){t=!0,e.splice(i,1);break}if(!1===t)return!1}return!0}return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$eqx: cannot compare [${u}] type with [${value_type}] type at [${t}].`),!1},ToMongoQuery:function(e){throw new Error("ToMongoQuery() is not implemented.")},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},105:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloau",Query:function(e,n,t=""){return!this.Engine.QueryOperators.$eqx.Query(e,n,t)},ToMongoQuery:function(e){throw new Error("ToMongoQuery() is not implemented.")},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},209:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(e,n,t){let i=this.Engine.ShortType(n);if("a"!==i)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$and: requires an array but found type [${i}] instead at [${t}].`),!1;for(let i=0;i<n.length;i++)if(!1===this.Engine.Query(e,n[i],t))return!1;return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},809:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(e,n,t=""){let i=this.Engine.ShortType(n);if("a"!==i)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$nor: requires an array but found type [${i}] instead at [${t}].`),!1;for(let i=0;i<n.length;i++)if(!0===this.Engine.Query(e,n[i],t))return!1;return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},8:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"or",Query:function(e,n,t=""){let i=n,r=this.Engine.ShortType(i),o=!1;return"o"===r?o=this.Engine.Query(e,i,t):"r"===r?o=this.Engine.QueryOperators.$regex.Query(e,i,t):this.Engine.Settings.Explain&&this.Engine.Explain.push(`$not: requires an object or regexp but found type [${r}] instead at [${t}].`),!o},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},577:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(e,n,t=""){let i=this.Engine.ShortType(n);if("a"!==i)return this.Engine.Settings.Explain&&this.Engine.Explain.push(`$or: requires an array but found type [${i}] instead at [${t}].`),!1;for(let i=0;i<n.length;i++)if(!0===this.Engine.Query(e,n[i],t))return!0;return!1},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},778:e=>{e.exports=function(e){let n=e;return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(e,t){if("o"!==n.ShortType(t))return n.Settings.Explain&&n.Explain.push("$addToSet: The UpdateFields parameter must be an object."),!1;for(let i in t){let r=n.GetValue(e,i);"a"===n.ShortType(r)?r.includes(t[i])||(r.push(t[i]),!1!==n.SetValue(e,i,r)||n.Settings.Explain&&n.Explain.push(`$addToSet: Setting the field [${i}] failed.`)):n.Settings.Explain&&n.Explain.push(`$addToSet: The field [${i}] must be an array.`)}return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},585:e=>{e.exports=function(e){let n=e;return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(e,t){if("o"!==n.ShortType(t))return n.Settings.Explain&&n.Explain.push("$pop: The UpdateFields parameter must be an object."),!1;for(let i in t){let r=n.GetValue(e,i);if("a"!==n.ShortType(r)){n.Settings.Explain&&n.Explain.push(`$pop: The field [${i}] must be an array.`);continue}let o=t[i];if(-1===o)r.length&&r.splice(0,1);else{if(1!==o){n.Settings.Explain&&n.Explain.push(`$pop: Invalid direction value [${r}] for field [${i}], should be -1 or 1.`);continue}r.length&&r.pop()}!1!==n.SetValue(e,i,r)||n.Settings.Explain&&n.Explain.push(`$pop: Setting the field [${i}] failed.`)}return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},164:e=>{e.exports=function(e){let n=e;return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(e,t){if("o"!==n.ShortType(t))return n.Settings.Explain&&n.Explain.push("$pullAll: The UpdateFields parameter must be an object."),!1;for(let i in t){let r=n.GetValue(e,i);if("a"!==n.ShortType(r)){n.Settings.Explain&&n.Explain.push(`$pullAll: The field [${i}] must be an array.`);continue}let o=t[i];if("a"===n.ShortType(o)){for(let e=r.length-1;e>=0;e--)o.includes(r[e])&&r.splice(e,1);!1!==n.SetValue(e,i,r)||n.Settings.Explain&&n.Explain.push(`$pullAll: Setting the field [${i}] failed.`)}else n.Settings.Explain&&n.Explain.push("$pullAll: The values to pull must be an array.")}return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},396:e=>{e.exports=function(e){let n=e;return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(e,t){if("o"!==n.ShortType(t))return n.Settings.Explain&&n.Explain.push("$push: The UpdateFields parameter must be an object."),!1;for(let i in t){let r=n.GetValue(e,i);if("a"!==n.ShortType(r)){n.Settings.Explain&&n.Explain.push(`$push: The field [${i}] must be an array.`);continue}let o=t[i];r.push(o),!1!==n.SetValue(e,i,r)||n.Settings.Explain&&n.Explain.push(`$push: Setting the field [${i}] failed.`)}return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},730:e=>{e.exports=function(e){let n=e;return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(e,t){let i=new Date;if("o"!==n.ShortType(t))return n.Settings.Explain&&n.Explain.push("$currentDate: The UpdateFields parameter must be an object."),!1;for(let r in t){let o=t[r],u=n.ShortType(o),l=null;if("b"===u)!0===o&&(l=i.toISOString());else{if("o"!==u){n.Settings.Explain&&n.Explain.push(`$currentDate: The date dpecification of [${JSON.stringify(o)}] for [${r}] is invalid.`);continue}if("string"==typeof o.$type)if(o=o.$type,"timestamp"===o)l=i.getTime();else{if("date"!==o){n.Settings.Explain&&n.Explain.push(`$currentDate: Unknown date dpecification [${o}] for [${r}] is invalid.`);continue}l=i.toDateString()}}null===l||!1!==n.SetValue(e,r,l)||n.Settings.Explain&&n.Explain.push(`$currentDate: Setting the value of [${r}] to [${l}] failed.`)}return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},95:e=>{e.exports=function(e){let n=e;return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(e,t){if("o"!==n.ShortType(t))return n.Settings.Explain&&n.Explain.push("$inc: The UpdateFields parameter must be an object."),!1;for(let i in t){let r=n.GetValue(e,i),o=n.AsNumber(t[i]);null!==o?(r+=o,!1===n.SetValue(e,i,r)&&n.Settings.Explain&&n.Explain.push(`$inc: Setting the value of [${i}] to [${r}] failed.`)):n.Settings.Explain&&n.Explain.push(`$inc: This operator requires a numeric value but found [${t[i]}] instead at [${i}].`)}return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},178:e=>{e.exports=function(e){let n=e;return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(e,t){if("o"!==n.ShortType(t))return n.Settings.Explain&&n.Explain.push("$max: The UpdateFields parameter must be an object."),!1;for(let i in t){let r=n.GetValue(e,i),o=n.AsNumber(t[i]);null!==o?o>r&&!1===n.SetValue(e,i,o)&&n.Settings.Explain&&n.Explain.push(`$max: Setting the value of [${i}] to [${r}] failed.`):n.Settings.Explain&&n.Explain.push(`$max: This operator requires a numeric value but found [${t[i]}] instead at [${i}].`)}return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},49:e=>{e.exports=function(e){let n=e;return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(e,t){if("o"!==n.ShortType(t))return n.Settings.Explain&&n.Explain.push("$min: The UpdateFields parameter must be an object."),!1;for(let i in t){let r=n.GetValue(e,i),o=n.AsNumber(t[i]);null!==o?o<r&&!1===n.SetValue(e,i,o)&&n.Settings.Explain&&n.Explain.push(`$min: Setting the value of [${i}] to [${r}] failed.`):n.Settings.Explain&&n.Explain.push(`$min: This operator requires a numeric value but found [${t[i]}] instead at [${i}].`)}return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},581:e=>{e.exports=function(e){let n=e;return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(e,t){if("o"!==n.ShortType(t))return n.Settings.Explain&&n.Explain.push("$mul: The UpdateFields parameter must be an object."),!1;for(let i in t){let r=n.GetValue(e,i),o=n.AsNumber(t[i]);null!==o?(r*=o,!1===n.SetValue(e,i,r)&&n.Settings.Explain&&n.Explain.push(`$mul: Setting the value of [${i}] to [${r}] failed.`)):n.Settings.Explain&&n.Explain.push(`$mul: This operator requires a numeric value but found [${t[i]}] instead at [${i}].`)}return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},818:e=>{e.exports=function(e){let n=e;return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(e,t){if("o"!==n.ShortType(t))return n.Settings.Explain&&n.Explain.push("$rename: The UpdateFields parameter must be an object."),!1;for(let i in t){let r=t[i],o=n.GetValue(e,i),u=null;u=n.SetValue(e,i,void 0),!1!==u?(u=n.SetValue(e,r,o),!1!==u||n.Settings.Explain&&n.Explain.push(`$rename: Setting the value of [${r}] to [${o}] failed.`)):n.Settings.Explain&&n.Explain.push(`$rename: Unsetting the value of [${i}] failed.`)}return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},652:e=>{e.exports=function(e){let n=e;return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(e,t){if("o"!==n.ShortType(t))return n.Settings.Explain&&n.Explain.push("$set: The UpdateFields parameter must be an object."),!1;for(let i in t){let r=t[i];!1===n.SetValue(e,i,r)&&n.Settings.Explain&&n.Explain.push(`$set: Setting the value of [${i}] to [${r}] failed.`)}return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},101:e=>{e.exports=function(e){let n=e;return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(e,t){if("o"!==n.ShortType(t))return n.Settings.Explain&&n.Explain.push("$unset: The UpdateFields parameter must be an object."),!1;for(let i in t)!1===n.SetValue(e,i,void 0)&&n.Settings.Explain&&n.Explain.push(`$unset: Unsetting the value of [${i}] failed.`);return!0},ToMongoQuery:function(e){return e},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},792:e=>{e.exports={Compare:function(e,n,t=!0){if("string"!=typeof e)throw new Error("The parameter [TextA] must be a string.");if("string"!=typeof n)throw new Error("The parameter [TextB] must be a string.");return t||(e=e.toLowerCase(),n=n.toLowerCase()),e.localeCompare(n)},FindBetween:function(e,n,t,i=!0){if("string"!=typeof e)throw new Error("The parameter [Text] must be a string.");if(null==n&&(n=""),"string"!=typeof n)throw new Error("The parameter [StartText] must be a string or null.");if(null==t&&(t=""),"string"!=typeof t)throw new Error("The parameter [EndText] must be a string or null.");let r=e;i||(r=r.toLowerCase(),n=n.toLowerCase(),t=t.toLowerCase());let o=0;if(n.length&&(o=r.indexOf(n)),o<0)return null;let u=r.length;return t.length&&(u=r.indexOf(t,o+n.length)),u<0?null:e.substring(o+n.length,u)},Matches:function(e,n,t=!0){let i=n.replace(/[.+^${}()|[\]\\]/g,"\\$&"),r="";return t||(r+="i"),new RegExp(`^${i.replace(/\*/g,".*").replace(/\?/g,".")}$`,r).test(e)}}},986:(e,n,t)=>{const i=t(792);e.exports=function(e={}){void 0===e.PathExtensions&&(e.PathExtensions=!1),void 0===e.Explain&&(e.Explain=!1),void 0===e.ClearExplainOnTopLevelQuery&&(e.ClearExplainOnTopLevelQuery=!0);let n={};return n.Settings=e,n.Explain=[],n.QueryOperators={$eq:t(374)(n),$ne:t(490)(n),$gt:t(132)(n),$gte:t(588)(n),$lt:t(207)(n),$lte:t(424)(n),$in:t(38)(n),$nin:t(879)(n),$and:t(209)(n),$or:t(577)(n),$nor:t(809)(n),$not:t(8)(n),$regex:t(940)(n),$elemMatch:t(999)(n),$size:t(950)(n),$all:t(863)(n),$exists:t(611)(n),$type:t(475)(n),$query:t(222)(n),$noop:t(718)(n),$ImplicitEq:t(469)(n),$eqx:t(239)(n),$nex:t(105)(n)},n.UpdateOperators={$set:t(652)(n),$unset:t(101)(n),$rename:t(818)(n),$inc:t(95)(n),$min:t(49)(n),$max:t(178)(n),$mul:t(581)(n),$currentDate:t(730)(n),$addToSet:t(778)(n),$pop:t(585)(n),$push:t(396)(n),$pullAll:t(164)(n)},n.AsNumber=function(e){try{if(!e)return null;let n=Number(e);return isNaN(n)?null:n}catch(e){return null}},n.AsDate=function(e){try{if(!e)return null;let n=new Date(e);return isNaN(n)?null:n}catch(e){return null}},n.ShortType=function(e){let n=typeof e;if("boolean"===n)return"b";if("number"===n)return"n";if("string"===n)return"s";if("object"===n)return null===e?"l":Array.isArray(e)?"a":e instanceof RegExp?"r":e instanceof Error?"e":"o";if("function"===n)return"f";if("symbol"===n)return"y";if("undefined"===n)return"u";throw new Error(`Unsupported data type [${n}].`)},n.BsonType=function(e,n=!1){let t=this.ShortType(e);if("b"===t)return n?"bool":8;if("n"===t)return e.toString().includes(".")?n?"double":1:Number.isSafeInteger(e)?n?"int":16:n?"long":18;if("s"===t)return n?"string":2;if("l"===t)return n?"null":10;if("o"===t)return n?"object":3;if("a"===t)return n?"array":4;if("r"===t)return n?"regex":11;if("f"===t);else{if("y"===t)return n?"symbol":14;if("u"===t)return n?"undefined":6}return null},n.Clone=function(e){return JSON.parse(JSON.stringify(e))},n.SafeClone=function(e){return function e(t){let i=n.ShortType(t);switch(i){case"b":case"n":case"s":case"l":case"r":case"e":case"f":case"y":case"u":return t;case"o":{let n={};for(let i in t)n[i]=e(t[i]);return n}case"a":{let n=[];for(let i=0;i<t.length;i++)n.push(e(t[i]));return n}default:throw new Error(`Unrecognized short type [${i}].`)}}(e)},n.MemberwiseClone=n.SafeClone,n.SplitPath=function(e){if("string"!=typeof e)return n.Settings.Explain&&n.Explain.push(`SplitPath: Path is invalid [${QueryPath}].`),null;if(""===e)return[];let t=e.split("."),r=0;for(;r<t.length;){let o=t[r];if(""===o)return n.Settings.Explain&&n.Explain.push(`SplitPath: Path cannot contain empty elements in [${e}].`),null;if("$"===o){if(0===r){if(!n.Settings.PathExtensions)return n.Settings.Explain&&n.Explain.push(`SplitPath: Path cannot start with the $ root element without path extensions in [${e}].`),null;t.splice(0,1);continue}return n.Settings.Explain&&n.Explain.push(`SplitPath: Cannot contain the $ element within path [${e}].`),null}let u=i.FindBetween(o,"[","]");if(n.Settings.PathExtensions&&u){if(isNaN(Number(u)))return n.Settings.Explain&&n.Explain.push(`SplitPath: A non-numeric array index [${u}] was found in [${e}].`),null;if(u=Number(u),o=i.FindBetween(o,null,"["),o&&o.length){if("$"===o){if(0!==r)return n.Settings.Explain&&n.Explain.push(`SplitPath: Cannot contain the $ element within path [${e}].`),null;if(!n.Settings.PathExtensions)return n.Settings.Explain&&n.Explain.push(`SplitPath: Path cannot start with the $ root element without path extensions in [${e}].`),null;t.splice(0,1)}else t[r]=o,r++;t.splice(r,0,u)}else t[r]=u}else isNaN(Number(o))||(t[r]=Number(o));r++}return t},n.JoinPaths=function(){let e=[];for(let t=0;t<arguments.length;t++){if(null===arguments[t])continue;let i=""+arguments[t],r=n.SplitPath(i);null!==r&&e.push(...r)}return e.join(".")},n.GetValue=function(e,t){if(void 0===t)return e;if(null===t)return e;if("string"!=typeof t)return void(n.Settings.Explain&&n.Explain.push(`GetValue: Path is invalid [${t}].`));if(0===t.length)return e;let i=n.SplitPath(t);if(null===i)return void(n.Settings.Explain&&n.Explain.push("GetValue: SplitPath returned null."));let r=e;for(let e=0;e<i.length;e++){let o=i[e];if(void 0===r[o]){if("number"==typeof o)return void(n.Settings.Explain&&n.Explain.push(`GetValue: Array index [${o}] is out of bounds at [${t}].`));if("a"!==n.ShortType(r))return;if(0===r.length)return;let u=[],l=i.slice(e).join(".");if(!1===n.PathTerminals(r,l,(function(e,n,t){u.push(e)})))return;return u}r=r[o]}return r},n.SetValue=function(e,t,i){let r=n.ShortType(e);if(!"oa".includes(r))return n.Settings.Explain&&n.Explain.push("SetValue: Document must be an object or array."),!1;let o=n.SplitPath(t);if(null===o)return n.Settings.Explain&&n.Explain.push("SetValue: SplitPath returned null."),!1;if(0===o.length)return n.Settings.Explain&&n.Explain.push("SetValue: Cannot set a value using an empty path."),!1;let u=e,l="";for(let e=0;e<o.length;e++){let t=o[e];l.length>0&&(l+="."),l+=t;let r=n.ShortType(u);if("o"===r){if("number"==typeof t)return n.Settings.Explain&&n.Explain.push(`SetValue: Type mismatch at [${l}]. Expected a field name but found an array index instead.`),!1;if(void 0===u[t]&&(u[t]={}),e===o.length-1)return void 0===i?delete u[t]:u[t]=JSON.parse(JSON.stringify(i)),!0}else if("a"===r){if("string"==typeof t)return n.Settings.Explain&&n.Explain.push(`SetValue: Type mismatch at [${l}]. Expected a array index but found a field name instead.`),!1;for(;u.length<t;)u.push(null);if(e===o.length-1)return void 0===i?u.splice(t,1):u[t]=JSON.parse(JSON.stringify(i)),!0}u=u[t]}return!0},n.PathTerminals=function(e,t,i){let r=function e(t,r,o){if(void 0===t)return!1;if(null===o)return!1;let u=t,l=n.ShortType(u),a=[...o];if("a"===l){if(a.length&&"number"==typeof a[0]){let t=a[0];a.splice(0,1);let i=n.JoinPaths(r,t);if(!e(u[t],i,a))return!1}else for(let t=0;t<u.length;t++)if(!e(u[t],n.JoinPaths(r,t),a))return!1}else if("o"===l){let t=a[0];a.splice(0,1);let o=u[t],l=n.ShortType(o),p=n.JoinPaths(r,t);if(0===a.length)if("a"===l){if(!e(o,p,a))return!1}else i(o,l,p);else if(!e(o,p,a))return!1}else{if(0!==a.length)return n.Settings.Explain&&n.Explain.push(`PathTerminals: Unresolved path elements exist: [${a.join(".")}].`),!1;i(u,l,r)}return!0}(e,"",n.SplitPath(t));return r},n.Query=function(e,t,i=""){if(""===i&&n.Settings.ClearExplainOnTopLevelQuery&&(n.Explain=[]),"o"!==n.ShortType(e))return n.Settings.Explain&&n.Explain.push("Query: The Document parameter must be an object."),!1;if("o"!==n.ShortType(t))return n.Settings.Explain&&n.Explain.push("Query: The Query parameter must be an object."),!1;{let e=n.SplitPath(i);i=null===e?"":e.join(".")}if(""===i&&0===Object.keys(t).length)return n.Settings.Explain&&n.Explain.push("Query: An empty query object {} matches everything."),!0;for(let r in t)if(void 0!==n.QueryOperators[r]){if(""===i&&!n.QueryOperators[r].TopLevel)return n.Settings.Explain&&n.Explain.push(`Query: Operator [${r}] cannot appear at the top level of a query. Only logical operators can appear at the top level of a query.`),!1;let o=t[r];if(void 0===o)return n.Settings.Explain&&n.Explain.push(`Query: Operator [${r}] cannot be set to undefined. Use $exists to chrck for a field in the document.`),!1;if(!1===n.QueryOperators[r].Query(e,o,i))return n.Settings.Explain&&n.Explain.push(`Query: Operator [${r}] returned false at [${i}].`),!1}else{let o=t[r],u=n.JoinPaths(i,r),l=!1;if(n.IsQuery(o))l=n.Query(e,o,u);else{if(void 0===o)return n.Settings.Explain&&n.Explain.push("Query: The implicit $eq operator cannot be set to undefined. Use $exists to chrck for a field in the document."),!1;l=n.QueryOperators.$ImplicitEq.Query(e,o,u)}if(!1===l)return!1}return!0},n.Projection=function(e,t){if(n.Settings.ClearExplainOnTopLevelQuery&&(n.Explain=[]),"o"!==n.ShortType(e))return n.Settings.Explain&&n.Explain.push("Projection: The Document parameter must be an object."),null;e=n.Clone(e);let i=n.ShortType(t);if(!0==="lu".includes(i))return e;if("o"!==i)return n.Settings.Explain&&n.Explain.push("Projection: The Projection parameter must be an object."),null;t=n.Clone(t);let r="",o=!0;for(let e in t){let i=t[e];if("_id"===e)0===i&&(o=!1),delete t[e];else if(1===i){if("exclude"===r)return n.Settings.Explain&&n.Explain.push("Update: Cannot combine inclusion and exclusion operators in the same update."),null;r="include"}else if(0===i){if("include"===r)return n.Settings.Explain&&n.Explain.push("Update: Cannot combine inclusion and exclusion operators in the same update."),null;r="exclude"}}""===r&&(r=o?"include":"exclude");let u=null;if("exclude"===r){u=n.Clone(e);for(let e in t)!1!==n.SetValue(u,e,void 0)||n.Settings.Explain&&n.Explain.push(`Projection: Failed to unset the field [${field}] in the projection.`)}else if("include"===r){u={_id:e._id};for(let i in t){let t=n.GetValue(e,i);!1!==n.SetValue(u,i,t)||n.Settings.Explain&&n.Explain.push(`Projection: Failed to set the field [${field}] in the projection.`)}}return!1===o&&delete u._id,u},n.Project=n.Projection,n.Update=function(e,t){if(n.Settings.ClearExplainOnTopLevelQuery&&(n.Explain=[]),"o"!==n.ShortType(e))return n.Settings.Explain&&n.Explain.push("Update: The Document parameter must be an object."),null;e=n.Clone(e);let i=n.ShortType(t);if(!0==="lu".includes(i))return e;if("o"!==i)return n.Settings.Explain&&n.Explain.push("Update: The Update parameter must be an object."),null;for(let i in t)void 0!==n.UpdateOperators[i]?!1===n.UpdateOperators[i].Update(e,t[i])&&n.Settings.Explain&&n.Explain.push(`Update: The update operator [${i}] failed.`):n.Settings.Explain&&n.Explain.push(`Update: Unknown update operator [${i}] encountered.`);return e},n.IsQuery=function(e){if("o"!==n.ShortType(e))return!1;for(let t in e)if(void 0!==n.QueryOperators[t])return!0;return!1},n.Equals=function(e,t,i=!1){return i?n.QueryOperators.$eq.Query(e,t):n.QueryOperators.$eqx.Query(e,t)},n.StrictEquals=function(e,t){return n.Equals(e,t,!0)},n}}},n={};return function t(i){var r=n[i];if(void 0!==r)return r.exports;var o=n[i]={exports:{}};return e[i](o,o.exports,t),o.exports}(986)})()));