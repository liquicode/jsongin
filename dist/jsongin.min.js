!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.jsongin=r():e.jsongin=r()}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var e={863:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"o",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),u=e.ShortType(o);if("a"!==u&&(o=[o]),"a"!==u)return e.OpLog&&e.OpLog(`$all: document requires an array but found type [${u}] instead at [${n}].`),!1;let a=e.ShortType(t);if("a"!==a)return e.OpLog&&e.OpLog(`$all: match requires an array but found type [${a}] instead at [${n}].`),!1;for(let u=0;u<t.length;u++){let p=!1,i=e.ShortType(t[u]);if("bnsl".includes(i)?p=o.includes(t[u]):"o"===i?p=e.Query(r,t[u],n):e.OpLog&&e.OpLog(`$all: sub-match requires "bnslo" but found type [${a}] instead at [${n}].`),!1===p)return!1}return!0}catch(r){throw e.OpError&&e.OpError(`Query.$all: ${r.message}`),r}}}}},999:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"o",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),u=e.ShortType(o);if("a"!==u)return e.OpLog&&e.OpLog(`$elemMatch: document requires an array but found type [${u}] instead at [${n}].`),!1;let a=e.ShortType(t);if("o"!==a)return e.OpLog&&e.OpLog(`$elemMatch: match requires an object but found type [${a}] instead at [${n}].`),!1;for(let u=0;u<o.length;u++){let o=e.JoinPaths(n,u);if(!0===e.Query(r,t,o))return!0}return!1}catch(r){throw e.OpError&&e.OpError(`Query.$elemMatch: ${r.message}`),r}}}}},950:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Array",TopLevel:!1,ValueTypes:"n",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),u=e.ShortType(o);if("a"!==u)return e.OpLog&&e.OpLog(`$size: requires an array but found type [${u}] instead at [${n}].`),!1;let a=e.ShortType(t);return"n"!==a?(e.OpLog&&e.OpLog(`$size: requires a number but found type [${a}] instead at [${n}].`),!1):o.length===t}catch(r){throw e.OpError&&e.OpError(`Query.$size: ${r.message}`),r}}}}},374:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),u=e.ShortType(o),a=t,p=e.ShortType(a);if("bnslru".includes(p)&&p===u)return o===a;if("lu".includes(p)&&"lu".includes(u))return!0;if("o"===p&&"o"===u)return!0==(JSON.stringify(a)===JSON.stringify(o));if("a"===p&&"a"===u){let e=JSON.stringify(a),r=e===JSON.stringify(o);if(!0===r)return!0;for(let t=0;t<o.length&&(r=e===JSON.stringify(o[t]),!0!==r);t++);return!0===r}return e.OpLog&&e.OpLog(`$eq: cannot compare [${p}] type with [${u}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$eq: ${r.message}`),r}}}}},132:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bns",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),u=e.ShortType(o),a=t,p=e.ShortType(a);if("bns".includes(p)&&p===u)return o>a;if("a".includes(u)){let e=!1;for(let r=0;r<o.length;r++)if(e=o[r]>a,!0===e)return!0;return!1}return e.OpLog&&e.OpLog(`$gt: cannot compare [${p}] type with [${u}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$gt: ${r.message}`),r}}}}},588:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnslu",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),u=e.ShortType(o),a=t,p=e.ShortType(a);if("bns".includes(p)&&p===u)return o>=a;if("lu".includes(p)&&"lu".includes(u))return!0;if("a".includes(u)){let e=!1;for(let r=0;r<o.length;r++)if(e=o[r]>=a,!0===e)return!0;return!1}return e.OpLog&&e.OpLog(`$gte: cannot compare [${p}] type with [${u}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$gte: ${r.message}`),r}}}}},38:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"a",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),u=e.ShortType(o),a=t,p=e.ShortType(a);if("a"!==p)return e.OpLog&&e.OpLog(`$in: expected an array but found a type [${p}] instead at [${n}].`),!1;function i(e,r,t){if("r"===e.ShortType(t)){for(let e=0;e<r.length;e++)if(t.test(r[e]))return!0}else if(r.includes(t))return!0;return!1}if("a"===u){for(let l=0;l<a.length;l++)if(i(e,o,a[l]))return!0}else if("bnslou".includes(u)&&i(e,a,o))return!0;return e.OpLog&&e.OpLog(`$in: cannot compare [${p}] type with [${u}] type at [${n}].`),!1}catch(s){throw e.OpError&&e.OpError(`Query.$in: ${s.message}`),s}}}}},207:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bns",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),u=e.ShortType(o),a=t,p=e.ShortType(a);if("bns".includes(p)&&p===u)return o<a;if("a".includes(u)){let e=!1;for(let r=0;r<o.length;r++)if(e=o[r]<a,!0===e)return!0;return!1}return e.OpLog&&e.OpLog(`$lt: cannot compare [${p}] type with [${u}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$lt: ${r.message}`),r}}}}},424:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnslu",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),u=e.ShortType(o),a=t,p=e.ShortType(a);if("bns".includes(p)&&p===u)return o<=a;if("lu".includes(p)&&"lu".includes(u))return!0;if("a".includes(u)){let e=!1;for(let r=0;r<o.length;r++)if(e=o[r]<=a,!0===e)return!0;return!1}return e.OpLog&&e.OpLog(`$lte: cannot compare [${p}] type with [${u}] type at [${n}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$lte: ${r.message}`),r}}}}},490:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloau",Query:function(r,t,n=""){return!e.QueryOperators.$eq.Query(r,t,n)}}}},879:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"a",Query:function(r,t,n=""){return!e.QueryOperators.$in.Query(r,t,n)}}}},611:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),u=e.ShortType(o),a=e.ShortType(t);if("b"!==a)return e.OpLog&&e.OpLog(`$exists: requires a boolean but found type [${a}] instead at [${n}].`),!1;if(!0===t){if("u"!==u)return!0}else if("u"===u)return!0;return!1}catch(r){throw e.OpError&&e.OpError(`Query.$exists: ${r.message}`),r}}}}},475:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"nsa",Query:function(r,t,n=""){try{let o=e.GetValue(r,n);"a"!==e.ShortType(o)&&(o=[o]);let u=e.ShortType(t);"a"!==u&&(t=[t]);for(let r=0;r<t.length;r++){let a=t[r];if(u=e.ShortType(a),"n"===u){for(let r=0;r<o.length;r++)if(a===e.BsonType(o[r],!1))return!0}else{if("s"!==u)return e.OpLog&&e.OpLog(`$type: requires a number or string but found type [${u}] instead at [${n}].`),!1;for(let r=0;r<o.length;r++){let t=e.BsonType(o[r],!0);if(a===t)return!0;if("number"===a&&["int","long","double","decimal"].includes(t))return!0}}}return!1}catch(r){throw e.OpError&&e.OpError(`Query.$type: ${r.message}`),r}}}}},940:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"sr",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),u=(e.ShortType(o),t),a=e.ShortType(u);return"sr".includes(a)?("s"===a&&(u=new RegExp(u)),u.test(o)):(e.OpLog&&e.OpLog(`$regex: requires regexp or string but found [${a}] instead at [${n}].`),!1)}catch(r){throw e.OpError&&e.OpError(`Query.$regex: ${r.message}`),r}}}}},469:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(r,t,n=""){try{let o=e.GetValue(r,n),u=e.ShortType(o),a=t,p=e.ShortType(a),i=e.IsQuery(a),l=!1;if("bnslu".includes(u)&&"bnslu".includes(p))return l=e.QueryOperators.$eq.Query(r,a,n),l;if("bnslu".includes(u)&&"a".includes(p))return e.OpLog&&e.OpLog(`ImplicitEq: cannot compare [${p}] type with [${u}] type at [${n}].`),!1;if("bnslu".includes(u)&&"o".includes(p))return i?(l=e.Query(r,a,n),l):(e.OpLog&&e.OpLog(`ImplicitEq: requires query when comparing against [${u}] type with [${u}] type at [${n}].`),!1);if("a".includes(u)&&"bnslu".includes(p))return l=o.includes(a),l;if("a".includes(u)&&"o".includes(p)){for(let t=0;t<o.length;t++){let o=e.JoinPaths(n,t);if(l=i?e.Query(r,a,o):e.QueryOperators.$eq.Query(r,a,o),!0===l)return!0}return!1}if("a".includes(u)&&"a".includes(p))return l=e.QueryOperators.$eq.Query(r,a,n),l;if("a".includes(u)&&"r".includes(p)){for(let t=0;t<o.length;t++){let o=e.JoinPaths(n,t);if(l=e.QueryOperators.$regex.Query(r,a,o),!1===l)return!1}return!0}return"o".includes(u)&&"o".includes(p)?i?(l=e.Query(r,a,n),l):(l=e.QueryOperators.$eq.Query(r,a,n),l):"s".includes(u)&&"r".includes(p)?(l=e.QueryOperators.$regex.Query(r,a,n),l):(e.OpLog&&e.OpLog(`ImplicitEq: cannot compare [${p}] type with [${u}] type at [${n}].`),!1)}catch(r){throw e.OpError&&e.OpError(`Query.$ImplicitEq: ${r.message}`),r}}}}},239:e=>{e.exports=e.exports=function(e){let r={Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloaru",Query:function(t,n,o=""){try{let u=e.GetValue(t,o),a=e.ShortType(u),p=n,i=e.ShortType(p);if("bns".includes(i)&&"bns".includes(a))return u==p;if("lu".includes(i)&&"lu".includes(a))return!0;if("bnslu".includes(i)||"bnslu".includes(a))return e.OpLog&&e.OpLog(`Query.$eqx: cannot compare primitive types to non-primitive types at [${o}].`),!1;if("o"===i&&"o"===a){for(let e in u)if(!1===r.Query(u[e],p[e],""))return!1;return!0}if("a"===i&&"a"===a){if(p.length!==u.length)return!1;let e=[...u];for(let t=0;t<p.length;t++){let n=!1;for(let o=0;o<e.length;o++)if(r.Query(p[t],e[o],"")){n=!0,e.splice(o,1);break}if(!1===n)return!1}return!0}return e.OpLog&&e.OpLog(`Query.$eqx: cannot compare [${i}] type with [${value_type}] type at [${o}].`),!1}catch(r){throw e.OpError&&e.OpError(`Query.$eqx: ${r.message}`),r}}};return r}},105:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Comparison",TopLevel:!1,ValueTypes:"bnsloau",Query:function(r,t,n=""){return!e.QueryOperators.$eqx.Query(r,t,n)}}}},565:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(r,t,n=""){return e.OpLog&&e.OpLog(`$noop: always returns true at [${n}].`),!0},ToMongoQuery:function(e){},ToSql:function(e){return""}}}},250:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Meta",TopLevel:!1,ValueTypes:"b",Query:function(e,r,t=""){return!0},ToMongoQuery:function(e){},ToSql:function(e){throw new Error("ToSql() is not implemented.")}}}},209:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(r,t,n){try{let o=e.ShortType(t);if("a"!==o)return e.OpLog&&e.OpLog(`$and: requires an array but found type [${o}] instead at [${n}].`),!1;for(let o=0;o<t.length;o++)if(!1===e.Query(r,t[o],n))return!1;return!0}catch(r){throw e.OpError&&e.OpError(`Query.$and: ${r.message}`),r}}}}},809:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(r,t,n=""){try{let o=e.ShortType(t);if("a"!==o)return e.OpLog&&e.OpLog(`$nor: requires an array but found type [${o}] instead at [${n}].`),!1;for(let o=0;o<t.length;o++)if(!0===e.Query(r,t[o],n))return!1;return!0}catch(r){throw e.OpError&&e.OpError(`Query.$nor: ${r.message}`),r}}}}},8:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"or",Query:function(r,t,n=""){try{let o=t,u=e.ShortType(o),a=!1;return"o"===u?a=e.Query(r,o,n):"r"===u?a=e.QueryOperators.$regex.Query(r,o,n):e.OpLog&&e.OpLog(`$not: requires an object or regexp but found type [${u}] instead at [${n}].`),!a}catch(r){throw e.OpError&&e.OpError(`Query.$not: ${r.message}`),r}}}}},577:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Logical",TopLevel:!0,ValueTypes:"a",Query:function(r,t,n=""){try{let o=e.ShortType(t);if("a"!==o)return e.OpLog&&e.OpLog(`$or: requires an array but found type [${o}] instead at [${n}].`),!1;for(let o=0;o<t.length;o++)if(!0===e.Query(r,t[o],n))return!0;return!1}catch(r){throw e.OpError&&e.OpError(`Query.$or: ${r.message}`),r}}}}},778:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let u=e.GetValue(r,o);"a"===e.ShortType(u)?u.includes(t[o])||(u.push(t[o]),!1!==e.SetValue(r,o,u)||(e.OpLog&&Engine.OpLog(`Update.$addToSet: Setting the value of [${o}] to [${JSON.stringify(value)}] failed.`),n=!1)):(e.OpLog&&e.OpLog(`Update.$addToSet: The field [${o}] must be an array.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$addToSet: ${r.message}`),r}}}}},585:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let u=e.GetValue(r,o);if("a"!==e.ShortType(u)){e.OpLog&&e.OpLog(`Update.$pop: The field [${o}] must be an array.`),n=!1;continue}let a=t[o];if(-1===a)u.length&&u.splice(0,1);else{if(1!==a){e.OpLog&&e.OpLog(`Update.$pop: Invalid direction value [${a}] for field [${o}], should be -1 or 1.`),n=!1;continue}u.length&&u.pop()}!1!==e.SetValue(r,o,u)||(e.OpLog&&Engine.OpLog(`Update.$pop: Setting the value of [${o}] to [${JSON.stringify(u)}] failed.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$pop: ${r.message}`),r}}}}},164:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let u=e.GetValue(r,o);if("a"!==e.ShortType(u)){e.OpLog&&e.OpLog(`Update.$pullAll: The field [${o}] must be an array.`),n=!1;continue}let a=t[o];if("a"===e.ShortType(a)){for(let e=u.length-1;e>=0;e--)a.includes(u[e])&&u.splice(e,1);!1!==e.SetValue(r,o,u)||(e.OpLog&&Engine.OpLog(`Update.$pullAll: Setting the value of [${o}] to [${JSON.stringify(u)}] failed.`),n=!1)}else e.OpLog&&e.OpLog("Update.$pullAll: The values to pull must be an array."),n=!1}return n}catch(r){throw e.OpError&&e.OpError(`Update.$pullAll: ${r.message}`),r}}}}},396:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let u=e.GetValue(r,o);if("a"!==e.ShortType(u)){e.OpLog&&e.OpLog(`Update.$push: The field [${o}] must be an array.`),n=!1;continue}let a=t[o];u.push(a),!1!==e.SetValue(r,o,u)||(e.OpLog&&Engine.OpLog(`Update.$push: Setting the value of [${o}] to [${JSON.stringify(u)}] failed.`),n=!1)}return!0}catch(r){throw e.OpError&&e.OpError(`Update.$push: ${r.message}`),r}}}}},730:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0,o=new Date;for(let u in t){let a=t[u],p=e.ShortType(a),i=null;if("b"===p)!0===a&&(i=o.toISOString());else{if("o"!==p){e.OpLog&&e.OpLog(`Update.$currentDate: The date dpecification of [${JSON.stringify(a)}] for [${u}] is invalid.`),n=!1;continue}if("string"==typeof a.$type)if(a=a.$type,"timestamp"===a)i=o.getTime();else{if("date"!==a){e.OpLog&&e.OpLog(`Update.$currentDate: Unknown date dpecification [${a}] for [${u}] is invalid.`),n=!1;continue}i=o.toDateString()}}null===i||!1!==e.SetValue(r,u,i)||(e.OpLog&&e.OpLog(`Update.$currentDate: Setting the value of [${u}] to [${JSON.stringify(i)}] failed.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$currentDate: ${r.message}`),r}}}}},95:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let u=e.GetValue(r,o),a=e.AsNumber(t[o]);null!==a?(u+=a,!1!==e.SetValue(r,o,u)||(e.OpLog&&e.OpLog(`Update.$inc: Setting the value of [${o}] to [${JSON.stringify(u)}] failed.`),n=!1)):(e.OpLog&&e.OpLog(`Update.$inc: This operator requires a numeric value but found [${t[o]}] instead at [${o}].`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$inc: ${r.message}`),r}}}}},178:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let u=e.GetValue(r,o),a=e.AsNumber(t[o]);if(null!==a){if(a>u&&!1===e.SetValue(r,o,a)){e.OpLog&&e.OpLog(`Update.$max: Setting the value of [${o}] to [${JSON.stringify(u)}] failed.`),n=!1;continue}}else e.OpLog&&e.OpLog(`Update.$max: This operator requires a numeric value but found [${t[o]}] instead at [${o}].`),n=!1}return n}catch(r){throw e.OpError&&e.OpError(`Update.$max: ${r.message}`),r}}}}},49:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let u=e.GetValue(r,o),a=e.AsNumber(t[o]);if(null!==a){if(a<u&&!1===e.SetValue(r,o,a)){e.OpLog&&e.OpLog(`Update.$min: Setting the value of [${o}] to [${JSON.stringify(u)}] failed.`),n=!1;continue}}else e.OpLog&&e.OpLog(`Update.$min: This operator requires a numeric value but found [${t[o]}] instead at [${o}].`),n=!1}return n}catch(r){throw e.OpError&&e.OpError(`Update.$min: ${r.message}`),r}}}}},581:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let u=e.GetValue(r,o),a=e.AsNumber(t[o]);null!==a?(u*=a,!1!==e.SetValue(r,o,u)||(e.OpLog&&e.OpLog(`Update.$mul: Setting the value of [${o}] to [${JSON.stringify(u)}] failed.`),n=!1)):(e.OpLog&&e.OpLog(`Update.$mul: This operator requires a numeric value but found [${t[o]}] instead at [${o}].`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$mul: ${r.message}`),r}}}}},818:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let u=t[o],a=e.GetValue(r,o),p=null;p=e.SetValue(r,o,void 0),!1!==p?(p=e.SetValue(r,u,a),!1!==p||(e.OpLog&&e.OpLog(`Update.$rename: Setting the value of [${u}] to [${JSON.stringify(a)}] failed.`),n=!1)):(e.OpLog&&e.OpLog(`Update.$rename: Unsetting the value of [${o}] failed.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$rename: ${r.message}`),r}}}}},652:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t){let u=t[o];!1!==e.SetValue(r,o,u)||(e.OpLog&&Engine.OpLog(`Update.$set: Setting the value of [${o}] to [${JSON.stringify(u)}] failed.`),n=!1)}return n}catch(r){throw e.OpError&&e.OpError(`Update.$set: ${r.message}`),r}}}}},101:e=>{e.exports=function(e){return{Engine:e,OperatorType:"Update",TopLevel:!0,ValueTypes:"o",Update:function(r,t){try{if("o"!==e.ShortType(t))throw new Error("The UpdateFields parameter must be an object.");let n=!0;for(let o in t)!1!==e.SetValue(r,o,void 0)||(Engine.OpLog&&Engine.OpLog(`Update.$unset: Unsetting the value of [${o}] failed.`),n=!1);return n}catch(r){throw e.OpError&&e.OpError(`Update.$unset: ${r.message}`),r}}}}},986:(e,r,t)=>{e.exports=function(e={}){void 0===e.OpLog&&(e.OpLog=null),void 0===e.OpError&&(e.OpError=null);let r={};return r.Settings=e,r.QueryOperators={$eq:t(374)(r),$ne:t(490)(r),$gt:t(132)(r),$gte:t(588)(r),$lt:t(207)(r),$lte:t(424)(r),$in:t(38)(r),$nin:t(879)(r),$and:t(209)(r),$or:t(577)(r),$nor:t(809)(r),$not:t(8)(r),$regex:t(940)(r),$elemMatch:t(999)(r),$size:t(950)(r),$all:t(863)(r),$exists:t(611)(r),$type:t(475)(r),$ImplicitEq:t(469)(r),$eqx:t(239)(r),$nex:t(105)(r),$query:t(250)(r),$noop:t(565)(r)},r.UpdateOperators={$set:t(652)(r),$unset:t(101)(r),$rename:t(818)(r),$inc:t(95)(r),$min:t(49)(r),$max:t(178)(r),$mul:t(581)(r),$currentDate:t(730)(r),$addToSet:t(778)(r),$pop:t(585)(r),$push:t(396)(r),$pullAll:t(164)(r)},r.Query=t(223)(r),r.Project=t(896)(r),r.Update=t(609)(r),r.SplitPath=t(415)(r),r.JoinPaths=t(345)(r),r.GetValue=t(231)(r),r.SetValue=t(931)(r),r.Flatten=t(87)(r),r.Expand=t(903)(r),r.Hybridize=t(824)(r),r.Unhybridize=t(159)(r),r.LooseEquals=function(e,t){return r.QueryOperators.$eqx.Query(e,t)},r.StrictEquals=function(e,t){return r.QueryOperators.$eq.Query(e,t)},r.Clone=function(e){return JSON.parse(JSON.stringify(e))},r.SafeClone=t(978)(r),r.ShortType=t(20)(r),r.BsonType=t(255)(r),r.OpLog=e.OpLog,r.OpError=e.OpError,r.AsNumber=function(e){try{if(!e)return null;let r=Number(e);return isNaN(r)?null:r}catch(e){return null}},r.AsDate=function(e){try{if(!e)return null;let r=new Date(e);return isNaN(r)?null:r}catch(e){return null}},r.IsQuery=function(e){if("o"!==r.ShortType(e))return!1;for(let t in e)if(void 0!==r.QueryOperators[t])return!0;return!1},r}},255:e=>{e.exports=function(e){return function(e,r=!1){let t=this.ShortType(e);if("b"===t)return r?"bool":8;if("n"===t)return e.toString().includes(".")?r?"double":1:Number.isSafeInteger(e)?r?"int":16:r?"long":18;if("s"===t)return r?"string":2;if("l"===t)return r?"null":10;if("o"===t)return r?"object":3;if("a"===t)return r?"array":4;if("r"===t)return r?"regex":11;if("f"===t);else{if("y"===t)return r?"symbol":14;if("u"===t)return r?"undefined":6}return null}}},903:e=>{e.exports=function(e){return function(r){try{if("o"!==e.ShortType(r))throw new Error("Document must be an object.");let t={};for(let n in r)e.SetValue(t,n,r[n]);return t}catch(r){throw e.OpError&&e.OpError("Expand: "+r.message),r}}}},87:e=>{e.exports=function(e){return function(r){try{let t={};function n(r,o){let u=e.ShortType(r);if("o"===u)for(let e in r){let t=o;t?t+="."+e:t=e,n(r[e],t)}else if("a"===u)for(let e=0;e<r.length;e++){let t=o;t?t+="."+e:t=""+e,n(r[e],t)}else t[o]=r}if(!"oa".includes(e.ShortType(r)))throw new Error("Document must be an object or array.");return n(r,""),t}catch(o){throw e.OpError&&e.OpError("Flatten: "+o.message),o}}}},231:(e,r,t)=>{t(986),e.exports=function(e){return function r(t,n){try{switch(e.ShortType(n)){case"u":case"l":return t;case"n":case"s":break;default:throw new Error(`Path is invalid [${JSON.stringify(n)}].`)}if(0===n.length)return t;let o=e.SplitPath(n),u=t;for(let t=0;t<o.length;t++){let n=o[t],a=e.ShortType(n),p=e.ShortType(u);if("a"===p){if("n"===a){if(n<0&&(n=u.length+n),n<0)return;if(n>=u.length)return;u=u[n];continue}{let e=[],n=o.slice(t).join(".");for(let t=0;t<u.length;t++){let o=r(u[t],n);e.push(o)}return e}}if("o"!==p)return;u=u[n]}return u}catch(r){throw e.OpError&&e.OpError("GetValue: "+r.message),r}}}},824:e=>{e.exports=function(e){return function(r){let t={};for(let n in r)switch(e.ShortType(r[n])){case"b":case"n":case"s":case"l":t[n]=r[n];break;case"o":t[n]=JSON.stringify({type:"o",value:r[n]});break;case"a":t[n]=JSON.stringify({type:"a",value:r[n]});break;case"r":t[n]=JSON.stringify({type:"r",flags:r[n].flags,source:r[n].source});break;case"e":t[n]=JSON.stringify({type:"e",message:r[n].message});break;case"f":t[n]=JSON.stringify({type:"f",source:r[n].toString()});break;case"y":t[n]=JSON.stringify({type:"y",source:r[n].toString()});break;case"u":t[n]=JSON.stringify({type:"u"})}return t}}},345:e=>{e.exports=function(e){return function(){try{let r=[];for(let t=0;t<arguments.length;t++){let n=arguments[t];switch(e.ShortType(n)){case"u":case"l":continue;case"n":n=[""+n];break;case"s":case"a":break;default:throw new Error(`Path segment is invalid [${JSON.stringify(n)}].`)}"string"==typeof n&&(n=e.SplitPath(n));let o=[];for(let r=0;r<n.length;r++){let t=e.SplitPath(n[r]);o.push(...t)}r.push(...o)}return r.join(".")}catch(r){throw e.OpError&&e.OpError("JoinPaths: "+r.message),r}}}},896:e=>{e.exports=function(e){return function(r,t){if("o"!==e.ShortType(r))return e.OpLog&&e.OpLog("Projection: The Document parameter must be an object."),null;r=e.Clone(r);let n=e.ShortType(t);if(!0==="lu".includes(n))return r;if("o"!==n)return e.OpLog&&e.OpLog("Projection: The Projection parameter must be an object."),null;t=e.Clone(t);let o="",u=!0;for(let r in t){let n=t[r];if("_id"===r)0===n&&(u=!1),delete t[r];else if(1===n){if("exclude"===o)return e.OpLog&&e.OpLog("Update: Cannot combine inclusion and exclusion operators in the same update."),null;o="include"}else if(0===n){if("include"===o)return e.OpLog&&e.OpLog("Update: Cannot combine inclusion and exclusion operators in the same update."),null;o="exclude"}}""===o&&(o=u?"include":"exclude");let a=null;if("exclude"===o){a=e.Clone(r);for(let r in t)!1!==e.SetValue(a,r,void 0)||e.OpLog&&e.OpLog(`Projection: Failed to unset the field [${field}] in the projection.`)}else if("include"===o){a={_id:r._id};for(let n in t){let t=e.GetValue(r,n);!1!==e.SetValue(a,n,t)||e.OpLog&&e.OpLog(`Projection: Failed to set the field [${field}] in the projection.`)}}return!1===u&&delete a._id,a}}},223:e=>{e.exports=function(e){return function(r,t,n=""){if("o"!==e.ShortType(r))return e.OpLog&&e.OpLog("Query: The Document parameter must be an object."),!1;if("o"!==e.ShortType(t))return e.OpLog&&e.OpLog("Query: The Criteria parameter must be an object."),!1;{let r=e.SplitPath(n);n=null===r?"":r.join(".")}if(""===n&&0===Object.keys(t).length)return e.OpLog&&e.OpLog("Query: An empty query object {} matches everything."),!0;for(let o in t)if(void 0!==e.QueryOperators[o]){if(""===n&&!e.QueryOperators[o].TopLevel)return e.OpLog&&e.OpLog(`Query: Operator [${o}] cannot appear at the top level of a query. Only logical operators can appear at the top level of a query.`),!1;let u=t[o];if(void 0===u)return e.OpLog&&e.OpLog(`Query: Operator [${o}] cannot be set to undefined. Use $exists to test if a field exists in the document.`),!1;if(!1===e.QueryOperators[o].Query(r,u,n))return e.OpLog&&e.OpLog(`Query: Operator [${o}] returned false at [${n}].`),!1}else{let u=t[o],a=e.JoinPaths(n,o),p=!1;if(e.IsQuery(u))p=e.Query(r,u,a);else{if(void 0===u)return e.OpLog&&e.OpLog("Query: The implicit $eq operator cannot be set to undefined. Use $exists to test if a field exists in the document."),!1;p=e.QueryOperators.$ImplicitEq.Query(r,u,a)}if(!1===p)return!1}return!0}}},978:e=>{e.exports=function(e){return function(r,t){try{switch(e.ShortType(t)){case"l":case"u":t=[];break;case"s":t=[t];break;case"a":break;default:throw new Error("The Exceptions parameter must be a document path or array of paths in dot notation.")}function n(r,o){let u=e.ShortType(r);switch(u){case"b":case"n":case"s":case"l":case"r":case"e":case"f":case"y":case"u":return r;case"o":{let e={};for(let u in r){let a=o;a?a+="."+u:a=u,t.includes(a)?e[u]=r[u]:e[u]=n(r[u],a)}return e}case"a":{let e=[];for(let u=0;u<r.length;u++){let a=o;a?a+="."+u:a=""+u,t.includes(a)?e.push(r[u]):e.push(n(r[u],a))}return e}default:throw new Error(`Unrecognized short type [${u}] at [${o}].`)}}return n(r,"")}catch(o){throw e.OpError&&e.OpError("SafeClone: "+o.message),o}}}},931:e=>{e.exports=function(e){return function r(t,n,o){try{switch(e.ShortType(t)){case"o":case"a":break;default:throw new Error("Document must be an object or array.")}switch(e.ShortType(n)){case"u":case"l":n="";break;case"n":case"s":break;default:throw new Error(`Path is invalid [${JSON.stringify(n)}].`)}if(0===n.length)return e.OpLog&&e.OpLog("SetValue: Path is empty."),!1;let u=e.SplitPath(n),a=t;for(let t=0;t<u.length;t++){let p=u[t],i=e.ShortType(p),l=e.ShortType(a);if("a"===l){if("n"===i){if(p<0&&(p=a.length+p),p<0)return e.OpLog&&e.OpLog(`SetValue: Disallowed negative array index [${p}] in path [${n}].`),!1;if(t===u.length-1)return a[p]=o,!0;if(void 0===a[p]){let r=e.ShortType(u[t+1]);a[p]="n"===r?[]:{}}a=a[p];continue}{let e=u.slice(t).join(".");for(let t=0;t<a.length;t++)if(!1===r(a[t],e,o))return!1;return!0}}if("o"!==l)throw new Error(`The element [${p}] of the path [${n}] must reference an object or array.`);if(t===u.length-1)return a[p]=o,!0;if(void 0!==a[p])a=a[p];else{let r=e.ShortType(u[t+1]);a[p]="n"===r?[]:{},a=a[p]}}return!0}catch(r){throw e.OpError&&e.OpError("SetValue: "+r.message),r}}}},20:e=>{e.exports=function(e){return function(e){let r=typeof e;if("boolean"===r)return"b";if("number"===r)return"n";if("string"===r)return"s";if("object"===r)return null===e?"l":Array.isArray(e)?"a":e instanceof RegExp?"r":e instanceof Error?"e":"o";if("function"===r)return"f";if("symbol"===r)return"y";if("undefined"===r)return"u";throw new Error(`Unsupported data type [${r}].`)}}},415:e=>{e.exports=function(e){return function(r){try{switch(e.ShortType(r)){case"u":case"l":return[];case"n":r=""+r;break;case"s":break;default:throw new Error(`Path is invalid [${JSON.stringify(r)}].`)}if(0===r.length)return[];let t=r.split(".");for(let r=0;r<t.length;r++){let n=t[r];null!==e.AsNumber(n)&&(n=Number(n)),t[r]=n}return t}catch(r){throw e.OpError&&e.OpError("SplitPath: "+r.message),r}}}},159:e=>{e.exports=function(e){return function(r){let t={};for(let n in r)switch(e.ShortType(r[n])){case"b":case"n":case"l":t[n]=r[n];break;case"s":try{let e=JSON.parse(r[n]);switch(e.type){case"o":case"a":t[n]=e.value;break;case"r":t[n]=new RegExp(e.source,e.flags);break;case"e":t[n]=new Error(r[n].message);break;case"f":t[n]=new Function(r[n].source);break;case"y":t[n]=Symbol(r[n].source);break;case"u":t[n]=void 0}break}catch(e){}t[n]=r[n]}return t}}},609:e=>{e.exports=function(e){return function(r,t){if("o"!==e.ShortType(r))return e.OpLog&&e.OpLog("Update: The Document parameter must be an object."),null;r=e.Clone(r);let n=e.ShortType(t);if(!0==="lu".includes(n))return r;if("o"!==n)return e.OpLog&&e.OpLog("Update: The Update parameter must be an object."),null;for(let n in t)void 0!==e.UpdateOperators[n]?!1===e.UpdateOperators[n].Update(r,t[n])&&e.OpLog&&e.OpLog(`Update: The update operator [${n}] failed.`):e.OpLog&&e.OpLog(`Update: Unknown update operator [${n}] encountered.`);return r}}}},r={};return function t(n){var o=r[n];if(void 0!==o)return o.exports;var u=r[n]={exports:{}};return e[n](u,u.exports,t),u.exports}(986)})()));